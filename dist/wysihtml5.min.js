(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof module==="object"&&module.exports){module.exports=b()}else{a.wysihtml5=b()}}}(this,function(){var b={version:"0.6.2",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\uFEFF",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,DOC_FRAGMENT_NODE:11,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=(function(){var l="object",i="function",B="undefined";var m=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var q=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function k(E,D){var C=typeof E[D];return C==i||(!!(C==l&&E[D]))||C=="unknown"}function f(D,C){return !!(typeof D[C]==l&&D[C])}function r(D,C){return typeof D[C]!=B}function n(C){return function(F,E){var D=E.length;while(D--){if(!C(F,E[D])){return false}}return true}}var p=n(k);var s=n(f);var A=n(r);function w(C){return C&&p(C,q)&&A(C,t)}var o={version:"1.2.2",initialized:false,supported:true,util:{isHostMethod:k,isHostObject:f,isHostProperty:r,areHostMethods:p,areHostObjects:s,areHostProperties:A,isTextRange:w},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function h(C){window.alert("Rangy not supported in your browser. Reason: "+C);o.initialized=true;o.supported=false}o.fail=h;function v(D){var C="Rangy warning: "+D;if(o.config.alertOnWarn){window.alert(C)}else{if(typeof window.console!=B&&typeof window.console.log!=B){window.console.log(C)}}}o.warn=v;if({}.hasOwnProperty){o.util.extend=function(E,D){for(var C in D){if(D.hasOwnProperty(C)){E[C]=D[C]}}}}else{h("hasOwnProperty not supported")}var x=[];var c=[];function u(){if(o.initialized){return}var E;var I=false,J=false;if(k(document,"createRange")){E=document.createRange();if(p(E,e)&&A(E,m)){I=true}E.detach()}var D=f(document,"body")?document.body:document.getElementsByTagName("body")[0];if(D&&k(D,"createTextRange")){E=D.createTextRange();if(w(E)){J=true}}if(!I&&!J){h("Neither Range nor TextRange are implemented")}o.initialized=true;o.features={implementsDomRange:I,implementsTextRange:J};var H=c.concat(x);for(var G=0,C=H.length;G<C;++G){try{H[G](o)}catch(F){if(f(window,"console")&&k(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",F)}}}}o.init=u;o.addInitListener=function(C){if(o.initialized){C(o)}else{x.push(C)}};var y=[];o.addCreateMissingNativeApiListener=function(C){y.push(C)};function g(E){E=E||window;u();for(var D=0,C=y.length;D<C;++D){y[D](E)}}o.createMissingNativeApi=g;function z(C){this.name=C;this.initialized=false;this.supported=false}z.prototype.fail=function(C){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+C)};z.prototype.warn=function(C){o.warn("Module "+this.name+": "+C)};z.prototype.createError=function(C){return new Error("Error in Rangy "+this.name+" module: "+C)};o.createModule=function(C,E){var D=new z(C);o.modules[C]=D;c.push(function(F){E(F,D);D.initialized=true;D.supported=true})};o.requireModules=function(E){for(var G=0,C=E.length,F,D;G<C;++G){D=E[G];F=o.modules[D];if(!F||!(F instanceof z)){throw new Error("Module '"+D+"' not found")}if(!F.supported){throw new Error("Module '"+D+"' not supported")}}};var d=false;var j=function(C){if(!d){d=true;if(!o.initialized){u()}}};if(typeof window==B){h("No window found");return}if(typeof document==B){h("No document found");return}if(k(document,"addEventListener")){document.addEventListener("DOMContentLoaded",j,false)}if(k(window,"addEventListener")){window.addEventListener("load",j,false)}else{if(k(window,"attachEvent")){window.attachEvent("onload",j)}else{h("Window does not have required addEventListener or attachEvent method")}}return o})();rangy.createModule("DomUtil",function(r,f){var v="undefined";var d=r.util;if(!d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){f.fail("document missing a Node creation method")}if(!d.isHostMethod(document,"getElementsByTagName")){f.fail("document missing getElementsByTagName method")}var g=document.createElement("div");if(!d.areHostMethods(g,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"]))){f.fail("Incomplete Element implementation")}if(!d.isHostProperty(g,"innerHTML")){f.fail("Element is missing innerHTML property")}var u=document.createTextNode("test");if(!d.areHostMethods(u,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(u,["data"]))){f.fail("Incomplete Text Node implementation")}var A=function(G,I){var H=G.length;while(H--){if(G[H]===I){return true}}return false};function k(H){var G;return typeof H.namespaceURI==v||((G=H.namespaceURI)===null||G=="http://www.w3.org/1999/xhtml")}function l(H){var G=H.parentNode;return(G.nodeType==1)?G:null}function c(H){var G=0;while((H=H.previousSibling)){G++}return G}function i(G){var H;return o(G)?G.length:((H=G.childNodes)?H.length:0)}function z(H,G){var I=[],J;for(J=H;J;J=J.parentNode){I.push(J)}for(J=G;J;J=J.parentNode){if(A(I,J)){return J}}return null}function E(G,H,J){var I=J?H:H.parentNode;while(I){if(I===G){return true}else{I=I.parentNode}}return false}function B(H,G,K){var I,J=K?H:H.parentNode;while(J){I=J.parentNode;if(I===G){return J}J=I}return null}function o(H){var G=H.nodeType;return G==3||G==4||G==8}function x(J,H){var G=H.nextSibling,I=H.parentNode;if(G){I.insertBefore(J,G)}else{I.appendChild(J)}return J}function y(I,G){var H=I.cloneNode(false);H.deleteData(0,G);I.deleteData(G,I.length-G);x(H,I);return H}function s(G){if(G.nodeType==9){return G}else{if(typeof G.ownerDocument!=v){return G.ownerDocument}else{if(typeof G.document!=v){return G.document}else{if(G.parentNode){return s(G.parentNode)}else{throw new Error("getDocument: no document found for node")}}}}}function n(G){var H=s(G);if(typeof H.defaultView!=v){return H.defaultView}else{if(typeof H.parentWindow!=v){return H.parentWindow}else{throw new Error("Cannot get a window object for node")}}}function D(G){if(typeof G.contentDocument!=v){return G.contentDocument}else{if(typeof G.contentWindow!=v){return G.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}}function h(G){if(typeof G.contentWindow!=v){return G.contentWindow}else{if(typeof G.contentDocument!=v){return G.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}}function F(G){return d.isHostObject(G,"body")?G.body:G.getElementsByTagName("body")[0]}function e(H){var G;while((G=H.parentNode)){H=G}return H}function t(J,L,I,K){var G,M,O,N,H;if(J==I){return L===K?0:(L<K)?-1:1}else{if((G=B(I,J,true))){return L<=c(G)?-1:1}else{if((G=B(J,I,true))){return c(G)<K?-1:1}else{M=z(J,I);O=(J===M)?M:B(J,M,true);N=(I===M)?M:B(I,M,true);if(O===N){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{H=M.firstChild;while(H){if(H===O){return -1}else{if(H===N){return 1}}H=H.nextSibling}throw new Error("Should not be here!")}}}}}function C(H){var G=s(H).createDocumentFragment(),I;while((I=H.firstChild)){G.appendChild(I)}return G}function q(G){if(!G){return"[No node]"}if(o(G)){return'"'+G.data+'"'}else{if(G.nodeType==1){var H=G.id?' id="'+G.id+'"':"";return"<"+G.nodeName+H+">["+G.childNodes.length+"]"}else{return G.nodeName}}}function p(G){this.root=G;this._next=G}p.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var I=this._current=this._next;var H,G;if(this._current){H=I.firstChild;if(H){this._next=H}else{G=null;while((I!==this.root)&&!(G=I.nextSibling)){I=I.parentNode}this._next=G}}return this._current},detach:function(){this._current=this._next=this.root=null}};function j(G){return new p(G)}function m(G,H){this.node=G;this.offset=H}m.prototype={equals:function(G){return this.node===G.node&this.offset==G.offset},inspect:function(){return"[DomPosition("+q(this.node)+":"+this.offset+")]"}};function w(G){this.code=this[G];this.codeName=G;this.message="DOMException: "+this.codeName}w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};w.prototype.toString=function(){return this.message};r.dom={arrayContains:A,isHtmlNamespace:k,parentElement:l,getNodeIndex:c,getNodeLength:i,getCommonAncestor:z,isAncestorOf:E,getClosestAncestorIn:B,isCharacterDataNode:o,insertAfter:x,splitDataNode:y,getDocument:s,getWindow:n,getIframeWindow:h,getIframeDocument:D,getBody:F,getRootContainer:e,comparePoints:t,inspectNode:q,fragmentFromNodeChildren:C,createIterator:j,DomPosition:m};r.DOMException=w});rangy.createModule("DomRange",function(k,h){k.requireModules(["DomUtil"]);var d=k.dom;var G=d.DomPosition;var V=k.DOMException;function z(an,e){return(an.nodeType!=3)&&(d.isAncestorOf(an,e.startContainer,true)||d.isAncestorOf(an,e.endContainer,true))}function o(e){return d.getDocument(e.startContainer)}function w(an,ar,ao){var aq=an._listeners[ar];if(aq){for(var ap=0,e=aq.length;ap<e;++ap){aq[ap].call(an,{target:an,args:ao})}}}function C(e){return new G(e.parentNode,d.getNodeIndex(e))}function Y(e){return new G(e.parentNode,d.getNodeIndex(e)+1)}function l(an,ap,ao){var e=an.nodeType==11?an.firstChild:an;if(d.isCharacterDataNode(ap)){if(ao==ap.length){d.insertAfter(an,ap)}else{ap.parentNode.insertBefore(an,ao==0?ap:d.splitDataNode(ap,ao))}}else{if(ao>=ap.childNodes.length){ap.appendChild(an)}else{ap.insertBefore(an,ap.childNodes[ao])}}return e}function J(ao){var an;for(var ap,aq=o(ao.range).createDocumentFragment(),e;ap=ao.next();){an=ao.isPartiallySelectedSubtree();ap=ap.cloneNode(!an);if(an){e=ao.getSubtreeIterator();ap.appendChild(J(e));e.detach(true)}if(ap.nodeType==10){throw new V("HIERARCHY_REQUEST_ERR")}aq.appendChild(ap)}return aq}function X(an,aq,e){var ao,at;e=e||{stop:false};for(var ap,ar;ap=an.next();){if(an.isPartiallySelectedSubtree()){if(aq(ap)===false){e.stop=true;return}else{ar=an.getSubtreeIterator();X(ar,aq,e);ar.detach(true);if(e.stop){return}}}else{ao=d.createIterator(ap);while((at=ao.next())){if(aq(at)===false){e.stop=true;return}}}}}function p(an){var e;while(an.next()){if(an.isPartiallySelectedSubtree()){e=an.getSubtreeIterator();p(e);e.detach(true)}else{an.remove()}}}function S(an){for(var ao,ap=o(an.range).createDocumentFragment(),e;ao=an.next();){if(an.isPartiallySelectedSubtree()){ao=ao.cloneNode(false);e=an.getSubtreeIterator();ao.appendChild(S(e));e.detach(true)}else{an.remove()}if(ao.nodeType==10){throw new V("HIERARCHY_REQUEST_ERR")}ap.appendChild(ao)}return ap}function r(ao,e,ap){var ar=!!(e&&e.length),aq;var at=!!ap;if(ar){aq=new RegExp("^("+e.join("|")+")$")}var an=[];X(new i(ao,false),function(au){if((!ar||aq.test(au.nodeType))&&(!at||ap(au))){an.push(au)}});return an}function B(e){var an=(typeof e.getName=="undefined")?"Range":e.getName();return"["+an+"("+d.inspectNode(e.startContainer)+":"+e.startOffset+", "+d.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function i(ao,an){this.range=ao;this.clonePartiallySelectedTextNodes=an;if(!ao.collapsed){this.sc=ao.startContainer;this.so=ao.startOffset;this.ec=ao.endContainer;this.eo=ao.endOffset;var e=ao.commonAncestorContainer;if(this.sc===this.ec&&d.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===e&&!d.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:d.getClosestAncestorIn(this.sc,e,true);this._last=(this.ec===e&&!d.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:d.getClosestAncestorIn(this.ec,e,true)}}}i.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var e=this._current=this._next;if(e){this._next=(e!==this._last)?e.nextSibling:null;if(d.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var an=this._current,ao,e;if(d.isCharacterDataNode(an)&&(an===this.sc||an===this.ec)){ao=(an===this.sc)?this.so:0;e=(an===this.ec)?this.eo:an.length;if(ao!=e){an.deleteData(ao,e-ao)}}else{if(an.parentNode){an.parentNode.removeChild(an)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return z(e,this.range)},getSubtreeIterator:function(){var an;if(this.isSingleCharacterDataNode){an=this.range.cloneRange();an.collapse()}else{an=new al(o(this.range));var ar=this._current;var ap=ar,e=0,aq=ar,ao=d.getNodeLength(ar);if(d.isAncestorOf(ar,this.sc,true)){ap=this.sc;e=this.so}if(d.isAncestorOf(ar,this.ec,true)){aq=this.ec;ao=this.eo}F(an,ap,e,aq,ao)}return new i(an,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function Q(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}Q.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};Q.prototype.toString=function(){return this.message};function y(an,e,ao){this.nodes=r(an,e,ao);this._next=this.nodes[0];this._position=0}y.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ag=[1,3,4,5,7,8,10];var ae=[2,9,11];var D=[5,6,10,12];var O=[1,3,4,5,7,8,10,11];var H=[1,3,4,5,7,8];function aa(e){return function(ao,aq){var an,ap=aq?ao:ao.parentNode;while(ap){an=ap.nodeType;if(d.arrayContains(e,an)){return ap}ap=ap.parentNode}return null}}var v=d.getRootContainer;var K=aa([9,11]);var M=aa(D);var f=aa([6,10,12]);function t(an,e){if(f(an,e)){throw new Q("INVALID_NODE_TYPE_ERR")}}function E(e){if(!e.startContainer){throw new V("INVALID_STATE_ERR")}}function W(e,an){if(!d.arrayContains(an,e.nodeType)){throw new Q("INVALID_NODE_TYPE_ERR")}}function af(e,an){if(an<0||an>(d.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new V("INDEX_SIZE_ERR")}}function g(an,e){if(K(an,true)!==K(e,true)){throw new V("WRONG_DOCUMENT_ERR")}}function ac(e){if(M(e,true)){throw new V("NO_MODIFICATION_ALLOWED_ERR")}}function aj(an,e){if(!an){throw new V(e)}}function q(e){return !d.arrayContains(ae,e.nodeType)&&!K(e,true)}function am(e,an){return an<=(d.isCharacterDataNode(e)?e.length:e.childNodes.length)}function j(e){E(e);if(q(e.startContainer)||q(e.endContainer)||!am(e.startContainer,e.startOffset)||!am(e.endContainer,e.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var c=document.createElement("style");var R=false;try{c.innerHTML="<b>x</b>";R=(c.firstChild.nodeType==3)}catch(ai){}k.features.htmlParsingConforms=R;var T=R?function(ao){var an=this.startContainer;var ap=d.getDocument(an);if(!an){throw new V("INVALID_STATE_ERR")}var e=null;if(an.nodeType==1){e=an}else{if(d.isCharacterDataNode(an)){e=d.parentElement(an)}}if(e===null||(e.nodeName=="HTML"&&d.isHtmlNamespace(d.getDocument(e).documentElement)&&d.isHtmlNamespace(e))){e=ap.createElement("body")}else{e=e.cloneNode(false)}e.innerHTML=ao;return d.fragmentFromNodeChildren(e)}:function(an){E(this);var ao=o(this);var e=ao.createElement("body");e.innerHTML=an;return d.fragmentFromNodeChildren(e)};var N=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var n=0,A=1,ah=2,ab=3;var u=0,x=1,L=2,m=3;function ad(){}ad.prototype={attachListener:function(e,an){this._listeners[e].push(an)},compareBoundaryPoints:function(ar,ao){j(this);g(this.startContainer,ao.startContainer);var au,an,at,e;var aq=(ar==ab||ar==n)?"start":"end";var ap=(ar==A||ar==n)?"start":"end";au=this[aq+"Container"];an=this[aq+"Offset"];at=ao[ap+"Container"];e=ao[ap+"Offset"];return d.comparePoints(au,an,at,e)},insertNode:function(an){j(this);W(an,O);ac(this.startContainer);if(d.isAncestorOf(an,this.startContainer,true)){throw new V("HIERARCHY_REQUEST_ERR")}var e=l(an,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){j(this);var ao,an;if(this.collapsed){return o(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&d.isCharacterDataNode(this.startContainer)){ao=this.startContainer.cloneNode(true);ao.data=ao.data.slice(this.startOffset,this.endOffset);an=o(this).createDocumentFragment();an.appendChild(ao);return an}else{var e=new i(this,true);ao=J(e);e.detach()}return ao}},canSurroundContents:function(){j(this);ac(this.startContainer);ac(this.endContainer);var e=new i(this,true);var an=(e._first&&(z(e._first,this))||(e._last&&z(e._last,this)));e.detach();return !an},surroundContents:function(an){W(an,H);if(!this.canSurroundContents()){throw new Q("BAD_BOUNDARYPOINTS_ERR")}var e=this.extractContents();if(an.hasChildNodes()){while(an.lastChild){an.removeChild(an.lastChild)}}l(an,this.startContainer,this.startOffset);an.appendChild(e);this.selectNode(an)},cloneRange:function(){j(this);var e=new al(o(this));var an=N.length,ao;while(an--){ao=N[an];e[ao]=this[ao]}return e},toString:function(){j(this);var an=this.startContainer;if(an===this.endContainer&&d.isCharacterDataNode(an)){return(an.nodeType==3||an.nodeType==4)?an.data.slice(this.startOffset,this.endOffset):""}else{var ao=[],e=new i(this,true);X(e,function(ap){if(ap.nodeType==3||ap.nodeType==4){ao.push(ap.data)}});e.detach();return ao.join("")}},compareNode:function(ao){j(this);var an=ao.parentNode;var aq=d.getNodeIndex(ao);if(!an){throw new V("NOT_FOUND_ERR")}var ap=this.comparePoint(an,aq),e=this.comparePoint(an,aq+1);if(ap<0){return(e>0)?L:u}else{return(e>0)?x:m}},comparePoint:function(e,an){j(this);aj(e,"HIERARCHY_REQUEST_ERR");g(e,this.startContainer);if(d.comparePoints(e,an,this.startContainer,this.startOffset)<0){return -1}else{if(d.comparePoints(e,an,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:T,toHtml:function(){j(this);var e=o(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(ap,e){j(this);aj(ap,"NOT_FOUND_ERR");if(d.getDocument(ap)!==o(this)){return false}var ao=ap.parentNode,ar=d.getNodeIndex(ap);aj(ao,"NOT_FOUND_ERR");var aq=d.comparePoints(ao,ar,this.endContainer,this.endOffset),an=d.comparePoints(ao,ar+1,this.startContainer,this.startOffset);return e?aq<=0&&an>=0:aq<0&&an>0},isPointInRange:function(e,an){j(this);aj(e,"HIERARCHY_REQUEST_ERR");g(e,this.startContainer);return(d.comparePoints(e,an,this.startContainer,this.startOffset)>=0)&&(d.comparePoints(e,an,this.endContainer,this.endOffset)<=0)},intersectsRange:function(an,e){j(this);if(o(an)!=o(this)){throw new V("WRONG_DOCUMENT_ERR")}var ap=d.comparePoints(this.startContainer,this.startOffset,an.endContainer,an.endOffset),ao=d.comparePoints(this.endContainer,this.endOffset,an.startContainer,an.startOffset);return e?ap<=0&&ao>=0:ap<0&&ao>0},intersection:function(e){if(this.intersectsRange(e)){var ap=d.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),an=d.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var ao=this.cloneRange();if(ap==-1){ao.setStart(e.startContainer,e.startOffset)}if(an==1){ao.setEnd(e.endContainer,e.endOffset)}return ao}return null},union:function(e){if(this.intersectsRange(e,true)){var an=this.cloneRange();if(d.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){an.setStart(e.startContainer,e.startOffset)}if(d.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){an.setEnd(e.endContainer,e.endOffset)}return an}else{throw new Q("Ranges do not intersect")}},containsNode:function(an,e){if(e){return this.intersectsNode(an,false)}else{return this.compareNode(an)==m}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,d.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(ap){var aq=this.cloneRange();aq.selectNode(ap);var ao=aq.getNodes([3]);if(ao.length>0){aq.setStart(ao[0],0);var e=ao.pop();aq.setEnd(e,e.length);var an=this.containsRange(aq);aq.detach();return an}else{return this.containsNodeContents(ap)}},createNodeIterator:function(e,an){j(this);return new y(this,e,an)},getNodes:function(e,an){j(this);return r(this,e,an)},getDocument:function(){return o(this)},collapseBefore:function(e){E(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){E(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return al.rangesEqual(this,e)},inspect:function(){return B(this)}};function U(e){e.START_TO_START=n;e.START_TO_END=A;e.END_TO_END=ah;e.END_TO_START=ab;e.NODE_BEFORE=u;e.NODE_AFTER=x;e.NODE_BEFORE_AND_AFTER=L;e.NODE_INSIDE=m}function I(e){U(e);U(e.prototype)}function s(e,an){return function(){j(this);var au=this.startContainer,at=this.startOffset,ao=this.commonAncestorContainer;var aq=new i(this,true);var ar,av;if(au!==ao){ar=d.getClosestAncestorIn(au,ao,true);av=Y(ar);au=av.node;at=av.offset}X(aq,ac);aq.reset();var ap=e(aq);aq.detach();an(this,au,at,au,at);return ap}}function Z(ap,at,e){function ar(av,au){return function(aw){E(this);W(aw,ag);W(v(aw),ae);var ax=(av?C:Y)(aw);(au?ao:aq)(this,ax.node,ax.offset)}}function ao(av,ax,ay){var aw=av.endContainer,au=av.endOffset;if(ax!==av.startContainer||ay!==av.startOffset){if(v(ax)!=v(aw)||d.comparePoints(ax,ay,aw,au)==1){aw=ax;au=ay}at(av,ax,ay,aw,au)}}function aq(au,av,ay){var ax=au.startContainer,aw=au.startOffset;if(av!==au.endContainer||ay!==au.endOffset){if(v(av)!=v(ax)||d.comparePoints(av,ay,ax,aw)==-1){ax=av;aw=ay}at(au,ax,aw,av,ay)}}function an(au,av,aw){if(av!==au.startContainer||aw!==au.startOffset||av!==au.endContainer||aw!==au.endOffset){at(au,av,aw,av,aw)}}ap.prototype=new ad();k.util.extend(ap.prototype,{setStart:function(au,av){E(this);t(au,true);af(au,av);ao(this,au,av)},setEnd:function(au,av){E(this);t(au,true);af(au,av);aq(this,au,av)},setStartBefore:ar(true,true),setStartAfter:ar(false,true),setEndBefore:ar(true,false),setEndAfter:ar(false,false),collapse:function(au){j(this);if(au){at(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{at(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(au){E(this);t(au,true);at(this,au,0,au,d.getNodeLength(au))},selectNode:function(av){E(this);t(av,false);W(av,ag);var aw=C(av),au=Y(av);at(this,aw.node,aw.offset,au.node,au.offset)},extractContents:s(S,at),deleteContents:s(p,at),canSurroundContents:function(){j(this);ac(this.startContainer);ac(this.endContainer);var au=new i(this,true);var av=(au._first&&(z(au._first,this))||(au._last&&z(au._last,this)));au.detach();return !av},detach:function(){e(this)},splitBoundaries:function(){j(this);var ay=this.startContainer,ax=this.startOffset,av=this.endContainer,au=this.endOffset;var aw=(ay===av);if(d.isCharacterDataNode(av)&&au>0&&au<av.length){d.splitDataNode(av,au)}if(d.isCharacterDataNode(ay)&&ax>0&&ax<ay.length){ay=d.splitDataNode(ay,ax);if(aw){au-=ax;av=ay}else{if(av==ay.parentNode&&au>=d.getNodeIndex(ay)){au++}}ax=0}at(this,ay,ax,av,au)},normalizeBoundaries:function(){j(this);var aB=this.startContainer,aw=this.startOffset,aA=this.endContainer,au=this.endOffset;var ax=function(aE){var aD=aE.nextSibling;if(aD&&aD.nodeType==aE.nodeType){aA=aE;au=aE.length;aE.appendData(aD.data);aD.parentNode.removeChild(aD)}};var aC=function(aF){var aE=aF.previousSibling;if(aE&&aE.nodeType==aF.nodeType){aB=aF;var aD=aF.length;aw=aE.length;aF.insertData(0,aE.data);aE.parentNode.removeChild(aE);if(aB==aA){au+=aw;aA=aB}else{if(aA==aF.parentNode){var aG=d.getNodeIndex(aF);if(au==aG){aA=aF;au=aD}else{if(au>aG){au--}}}}}};var az=true;if(d.isCharacterDataNode(aA)){if(aA.length==au){ax(aA)}}else{if(au>0){var ay=aA.childNodes[au-1];if(ay&&d.isCharacterDataNode(ay)){ax(ay)}}az=!this.collapsed}if(az){if(d.isCharacterDataNode(aB)){if(aw==0){aC(aB)}}else{if(aw<aB.childNodes.length){var av=aB.childNodes[aw];if(av&&d.isCharacterDataNode(av)){aC(av)}}}}else{aB=aA;aw=au}at(this,aB,aw,aA,au)},collapseToPoint:function(au,av){E(this);t(au,true);af(au,av);an(this,au,av)}});I(ap)}function P(e){e.collapsed=(e.startContainer===e.endContainer&&e.startOffset===e.endOffset);e.commonAncestorContainer=e.collapsed?e.startContainer:d.getCommonAncestor(e.startContainer,e.endContainer)}function F(ao,aq,an,ar,ap){var e=(ao.startContainer!==aq||ao.startOffset!==an);var at=(ao.endContainer!==ar||ao.endOffset!==ap);ao.startContainer=aq;ao.startOffset=an;ao.endContainer=ar;ao.endOffset=ap;P(ao);w(ao,"boundarychange",{startMoved:e,endMoved:at})}function ak(e){E(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;w(e,"detach",null);e._listeners=null}function al(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};P(this)}Z(al,F,ak);k.rangePrototype=ad.prototype;al.rangeProperties=N;al.RangeIterator=i;al.copyComparisonConstants=I;al.createPrototypeRange=Z;al.inspect=B;al.getRangeDocument=o;al.rangesEqual=function(an,e){return an.startContainer===e.startContainer&&an.startOffset===e.startOffset&&an.endContainer===e.endContainer&&an.endOffset===e.endOffset};k.DomRange=al;k.RangeException=Q});rangy.createModule("WrappedRange",function(k,f){k.requireModules(["DomUtil","DomRange"]);var c;var j=k.dom;var d=j.DomPosition;var l=k.DomRange;function g(s){var q=s.parentElement();var o=s.duplicate();o.collapse(true);var r=o.parentElement();o=s.duplicate();o.collapse(false);var p=o.parentElement();var n=(r==p)?r:j.getCommonAncestor(r,p);return n==q?n:j.getCommonAncestor(q,n)}function e(n){return n.compareEndPoints("StartToEnd",n)==0}function h(B,y,p,u){var C=B.duplicate();C.collapse(p);var A=C.parentElement();if(!j.isAncestorOf(y,A,true)){A=y}if(!A.canHaveHTML){return new d(A.parentNode,j.getNodeIndex(A))}var o=j.getDocument(A).createElement("span");var z,w=p?"StartToStart":"StartToEnd";var x,s,n,q;do{A.insertBefore(o,o.previousSibling);C.moveToElementText(o)}while((z=C.compareEndPoints(w,B))>0&&o.previousSibling);q=o.nextSibling;if(z==-1&&q&&j.isCharacterDataNode(q)){C.setEndPoint(p?"EndToStart":"EndToEnd",B);var t;if(/[\r\n]/.test(q.data)){var v=C.duplicate();var r=v.text.replace(/\r\n/g,"\r").length;t=v.moveStart("character",r);while((z=v.compareEndPoints("StartToEnd",v))==-1){t++;v.moveStart("character",1)}}else{t=C.text.length}n=new d(q,t)}else{x=(u||!p)&&o.previousSibling;s=(u||p)&&o.nextSibling;if(s&&j.isCharacterDataNode(s)){n=new d(s,0)}else{if(x&&j.isCharacterDataNode(x)){n=new d(x,x.length)}else{n=new d(A,j.getNodeIndex(o))}}}o.parentNode.removeChild(o);return n}function m(n,p){var q,t,r=n.offset;var u=j.getDocument(n.node);var o,v,w=u.body.createTextRange();var s=j.isCharacterDataNode(n.node);if(s){q=n.node;t=q.parentNode}else{v=n.node.childNodes;q=(r<v.length)?v[r]:null;t=n.node}o=u.createElement("span");o.innerHTML="&#feff;";if(q){t.insertBefore(o,q)}else{t.appendChild(o)}w.moveToElementText(o);w.collapse(!p);t.removeChild(o);if(s){w[p?"moveStart":"moveEnd"]("character",r)}return w}if(k.features.implementsDomRange&&(!k.features.implementsTextRange||!k.config.preferTextRange)){(function(){var p;var u=l.rangeProperties;var x;function n(y){var z=u.length,A;while(z--){A=u[z];y[A]=y.nativeRange[A]}}function q(A,C,z,D,B){var y=(A.startContainer!==C||A.startOffset!=z);var E=(A.endContainer!==D||A.endOffset!=B);if(y||E){A.setEnd(D,B);A.setStart(C,z)}}function v(y){y.nativeRange.detach();y.detached=true;var z=u.length,A;while(z--){A=u[z];y[A]=null}}var o;c=function(y){if(!y){throw new Error("Range must be specified")}this.nativeRange=y;n(this)};l.createPrototypeRange(c,q,v);p=c.prototype;p.selectNode=function(y){this.nativeRange.selectNode(y);n(this)};p.deleteContents=function(){this.nativeRange.deleteContents();n(this)};p.extractContents=function(){var y=this.nativeRange.extractContents();n(this);return y};p.cloneContents=function(){return this.nativeRange.cloneContents()};p.surroundContents=function(y){this.nativeRange.surroundContents(y);n(this)};p.collapse=function(y){this.nativeRange.collapse(y);n(this)};p.cloneRange=function(){return new c(this.nativeRange.cloneRange())};p.refresh=function(){n(this)};p.toString=function(){return this.nativeRange.toString()};var t=document.createTextNode("test");j.getBody(document).appendChild(t);var r=document.createRange();r.setStart(t,0);r.setEnd(t,0);try{r.setStart(t,1);x=true;p.setStart=function(y,z){this.nativeRange.setStart(y,z);n(this)};p.setEnd=function(y,z){this.nativeRange.setEnd(y,z);n(this)};o=function(y){return function(z){this.nativeRange[y](z);n(this)}}}catch(s){x=false;p.setStart=function(z,A){try{this.nativeRange.setStart(z,A)}catch(y){this.nativeRange.setEnd(z,A);this.nativeRange.setStart(z,A)}n(this)};p.setEnd=function(z,A){try{this.nativeRange.setEnd(z,A)}catch(y){this.nativeRange.setStart(z,A);this.nativeRange.setEnd(z,A)}n(this)};o=function(y,z){return function(B){try{this.nativeRange[y](B)}catch(A){this.nativeRange[z](B);this.nativeRange[y](B)}n(this)}}}p.setStartBefore=o("setStartBefore","setEndBefore");p.setStartAfter=o("setStartAfter","setEndAfter");p.setEndBefore=o("setEndBefore","setStartBefore");p.setEndAfter=o("setEndAfter","setStartAfter");r.selectNodeContents(t);if(r.startContainer==t&&r.endContainer==t&&r.startOffset==0&&r.endOffset==t.length){p.selectNodeContents=function(y){this.nativeRange.selectNodeContents(y);n(this)}}else{p.selectNodeContents=function(y){this.setStart(y,0);this.setEnd(y,l.getEndOffset(y))}}r.selectNodeContents(t);r.setEnd(t,3);var w=document.createRange();w.selectNodeContents(t);w.setEnd(t,4);w.setStart(t,2);if(r.compareBoundaryPoints(r.START_TO_END,w)==-1&r.compareBoundaryPoints(r.END_TO_START,w)==1){p.compareBoundaryPoints=function(z,y){y=y.nativeRange||y;if(z==y.START_TO_END){z=y.END_TO_START}else{if(z==y.END_TO_START){z=y.START_TO_END}}return this.nativeRange.compareBoundaryPoints(z,y)}}else{p.compareBoundaryPoints=function(z,y){return this.nativeRange.compareBoundaryPoints(z,y.nativeRange||y)}}if(k.util.isHostMethod(r,"createContextualFragment")){p.createContextualFragment=function(y){return this.nativeRange.createContextualFragment(y)}}j.getBody(document).removeChild(t);r.detach();w.detach()})();k.createNativeRange=function(n){n=n||document;return n.createRange()}}else{if(k.features.implementsTextRange){c=function(n){this.textRange=n;this.refresh()};c.prototype=new l(document);c.prototype.refresh=function(){var p,n;var o=g(this.textRange);if(e(this.textRange)){n=p=h(this.textRange,o,true,true)}else{p=h(this.textRange,o,true,false);n=h(this.textRange,o,false,false)}this.setStart(p.node,p.offset);this.setEnd(n.node,n.offset)};l.copyComparisonConstants(c);var i=(function(){return this})();if(typeof i.Range=="undefined"){i.Range=c}k.createNativeRange=function(n){n=n||document;return n.body.createTextRange()}}}if(k.features.implementsTextRange){c.rangeToTextRange=function(n){if(n.collapsed){var q=m(new d(n.startContainer,n.startOffset),true);return q}else{var r=m(new d(n.startContainer,n.startOffset),true);var p=m(new d(n.endContainer,n.endOffset),false);var o=j.getDocument(n.startContainer).body.createTextRange();o.setEndPoint("StartToStart",r);o.setEndPoint("EndToEnd",p);return o}}}c.prototype.getName=function(){return"WrappedRange"};k.WrappedRange=c;k.createRange=function(n){n=n||document;return new c(k.createNativeRange(n))};k.createRangyRange=function(n){n=n||document;return new l(n)};k.createIframeRange=function(n){return k.createRange(j.getIframeDocument(n))};k.createIframeRangyRange=function(n){return k.createRangyRange(j.getIframeDocument(n))};k.addCreateMissingNativeApiListener(function(o){var n=o.document;if(typeof n.createRange=="undefined"){n.createRange=function(){return k.createRange(this)}}n=o=null})});rangy.createModule("WrappedSelection",function(i,f){i.requireModules(["DomUtil","DomRange","WrappedRange"]);i.config.checkSelectionRanges=true;var F="boolean",V="_rangySelection",e=i.dom,n=i.util,S=i.DomRange,g=i.WrappedRange,P=i.DOMException,A=e.DomPosition,y,p,W="Control";function o(Y){return(Y||window).getSelection()}function s(Y){return(Y||window).document.selection}var U=i.util.isHostMethod(window,"getSelection"),O=i.util.isHostObject(document,"selection");var w=O&&(!U||i.config.preferTextRange);if(w){y=s;i.isSelectionValid=function(Z){var aa=(Z||window).document,Y=aa.selection;return(Y.type!="None"||e.getDocument(Y.createRange().parentElement())==aa)}}else{if(U){y=o;i.isSelectionValid=function(){return true}}else{f.fail("Neither document.selection or window.getSelection() detected.")}}i.getNativeSelection=y;var N=y();var D=i.createNativeRange(document);var E=e.getBody(document);var L=n.areHostObjects(N,["anchorNode","focusNode"]&&n.areHostProperties(N,["anchorOffset","focusOffset"]));i.features.selectionHasAnchorAndFocus=L;var r=n.isHostMethod(N,"extend");i.features.selectionHasExtend=r;var X=(typeof N.rangeCount=="number");i.features.selectionHasRangeCount=X;var R=false;var Q=true;if(n.areHostMethods(N,["addRange","getRangeAt","removeAllRanges"])&&typeof N.rangeCount=="number"&&i.features.implementsDomRange){(function(){var aa=document.createElement("iframe");E.appendChild(aa);var ae=e.getIframeDocument(aa);ae.open();ae.write("<html><head></head><body>12</body></html>");ae.close();var ac=e.getIframeWindow(aa).getSelection();var af=ae.documentElement;var ab=af.lastChild,ad=ab.firstChild;var Z=ae.createRange();Z.setStart(ad,1);Z.collapse(true);ac.addRange(Z);Q=(ac.rangeCount==1);ac.removeAllRanges();var Y=Z.cloneRange();Z.setStart(ad,0);Y.setEnd(ad,2);ac.addRange(Z);ac.addRange(Y);R=(ac.rangeCount==2);Z.detach();Y.detach();E.removeChild(aa)})()}i.features.selectionSupportsMultipleRanges=R;i.features.collapsedNonEditableSelectionsSupported=Q;var h=false,l;if(E&&n.isHostMethod(E,"createControlRange")){l=E.createControlRange();if(n.areHostProperties(l,["item","add"])){h=true}}i.features.implementsControlRange=h;if(L){p=function(Y){return Y.anchorNode===Y.focusNode&&Y.anchorOffset===Y.focusOffset}}else{p=function(Y){return Y.rangeCount?Y.getRangeAt(Y.rangeCount-1).collapsed:false}}function d(ab,Z,Y){var aa=Y?"end":"start",ac=Y?"start":"end";ab.anchorNode=Z[aa+"Container"];ab.anchorOffset=Z[aa+"Offset"];ab.focusNode=Z[ac+"Container"];ab.focusOffset=Z[ac+"Offset"]}function x(Z){var Y=Z.nativeSelection;Z.anchorNode=Y.anchorNode;Z.anchorOffset=Y.anchorOffset;Z.focusNode=Y.focusNode;Z.focusOffset=Y.focusOffset}function I(Y){Y.anchorNode=Y.focusNode=null;Y.anchorOffset=Y.focusOffset=0;Y.rangeCount=0;Y.isCollapsed=true;Y._ranges.length=0}function K(Y){var Z;if(Y instanceof S){Z=Y._selectionNativeRange;if(!Z){Z=i.createNativeRange(e.getDocument(Y.startContainer));Z.setEnd(Y.endContainer,Y.endOffset);Z.setStart(Y.startContainer,Y.startOffset);Y._selectionNativeRange=Z;Y.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(Y instanceof g){Z=Y.nativeRange}else{if(i.features.implementsDomRange&&(Y instanceof e.getWindow(Y.startContainer).Range)){Z=Y}}}return Z}function m(aa){if(!aa.length||aa[0].nodeType!=1){return false}for(var Z=1,Y=aa.length;Z<Y;++Z){if(!e.isAncestorOf(aa[0],aa[Z])){return false}}return true}function M(Z){var Y=Z.getNodes();if(!m(Y)){throw new Error("getSingleElementFromRange: range "+Z.inspect()+" did not consist of a single element")}return Y[0]}function H(Y){return !!Y&&typeof Y.text!="undefined"}function J(aa,Z){var Y=new g(Z);aa._ranges=[Y];d(aa,Y,false);aa.rangeCount=1;aa.isCollapsed=Y.collapsed}function v(ab){ab._ranges.length=0;if(ab.docSelection.type=="None"){I(ab)}else{var aa=ab.docSelection.createRange();if(H(aa)){J(ab,aa)}else{ab.rangeCount=aa.length;var Y,ac=e.getDocument(aa.item(0));for(var Z=0;Z<ab.rangeCount;++Z){Y=i.createRange(ac);Y.selectNode(aa.item(Z));ab._ranges.push(Y)}ab.isCollapsed=ab.rangeCount==1&&ab._ranges[0].collapsed;d(ab,ab._ranges[ab.rangeCount-1],false)}}}function z(Z,ac){var aa=Z.docSelection.createRange();var Y=M(ac);var ag=e.getDocument(aa.item(0));var ad=e.getBody(ag).createControlRange();for(var ab=0,ae=aa.length;ab<ae;++ab){ad.add(aa.item(ab))}try{ad.add(Y)}catch(af){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}ad.select();v(Z)}var q;if(n.isHostMethod(N,"getRangeAt")){q=function(aa,Y){try{return aa.getRangeAt(Y)}catch(Z){return null}}}else{if(L){q=function(Z){var aa=e.getDocument(Z.anchorNode);var Y=i.createRange(aa);Y.setStart(Z.anchorNode,Z.anchorOffset);Y.setEnd(Z.focusNode,Z.focusOffset);if(Y.collapsed!==this.isCollapsed){Y.setStart(Z.focusNode,Z.focusOffset);Y.setEnd(Z.anchorNode,Z.anchorOffset)}return Y}}}function C(Y,aa,Z){this.nativeSelection=Y;this.docSelection=aa;this._ranges=[];this.win=Z;this.refresh()}i.getSelection=function(aa){aa=aa||window;var Z=aa[V];var Y=y(aa),ab=O?s(aa):null;if(Z){Z.nativeSelection=Y;Z.docSelection=ab;Z.refresh(aa)}else{Z=new C(Y,ab,aa);aa[V]=Z}return Z};i.getIframeSelection=function(Y){return i.getSelection(e.getIframeWindow(Y))};var c=C.prototype;function k(ad,Y){var ae=e.getDocument(Y[0].startContainer);var ab=e.getBody(ae).createControlRange();for(var aa=0,ac;aa<rangeCount;++aa){ac=M(Y[aa]);try{ab.add(ac)}catch(Z){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}ab.select();v(ad)}if(!w&&L&&n.areHostMethods(N,["removeAllRanges","addRange"])){c.removeAllRanges=function(){this.nativeSelection.removeAllRanges();I(this)};var j=function(aa,Y){var ab=S.getRangeDocument(Y);var Z=i.createRange(ab);Z.collapseToPoint(Y.endContainer,Y.endOffset);aa.nativeSelection.addRange(K(Z));aa.nativeSelection.extend(Y.startContainer,Y.startOffset);aa.refresh()};if(X){c.addRange=function(Z,Y){if(h&&O&&this.docSelection.type==W){z(this,Z)}else{if(Y&&r){j(this,Z)}else{var aa;if(R){aa=this.rangeCount}else{this.removeAllRanges();aa=0}this.nativeSelection.addRange(K(Z));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==aa+1){if(i.config.checkSelectionRanges){var ab=q(this.nativeSelection,this.rangeCount-1);if(ab&&!S.rangesEqual(ab,Z)){Z=new g(ab)}}this._ranges[this.rangeCount-1]=Z;d(this,Z,t(this.nativeSelection));this.isCollapsed=p(this)}else{this.refresh()}}}}}else{c.addRange=function(Z,Y){if(Y&&r){j(this,Z)}else{this.nativeSelection.addRange(K(Z));this.refresh()}}}c.setRanges=function(Z){if(h&&Z.length>1){k(this,Z)}else{this.removeAllRanges();for(var aa=0,Y=Z.length;aa<Y;++aa){this.addRange(Z[aa])}}}}else{if(n.isHostMethod(N,"empty")&&n.isHostMethod(D,"select")&&h&&w){c.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var ab;if(this.anchorNode){ab=e.getDocument(this.anchorNode)}else{if(this.docSelection.type==W){var Z=this.docSelection.createRange();if(Z.length){ab=e.getDocument(Z.item(0)).body.createTextRange()}}}if(ab){var aa=ab.body.createTextRange();aa.select();this.docSelection.empty()}}}catch(Y){}I(this)};c.addRange=function(Y){if(this.docSelection.type==W){z(this,Y)}else{g.rangeToTextRange(Y).select();this._ranges[0]=Y;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;d(this,Y,false)}};c.setRanges=function(Y){this.removeAllRanges();var Z=Y.length;if(Z>1){k(this,Y)}else{if(Z){this.addRange(Y[0])}}}}else{f.fail("No means of selecting a Range or TextRange was found");return false}}c.getRangeAt=function(Y){if(Y<0||Y>=this.rangeCount){throw new P("INDEX_SIZE_ERR")}else{return this._ranges[Y]}};var G;if(w){G=function(Z){var Y;if(i.isSelectionValid(Z.win)){Y=Z.docSelection.createRange()}else{Y=e.getBody(Z.win.document).createTextRange();Y.collapse(true)}if(Z.docSelection.type==W){v(Z)}else{if(H(Y)){J(Z,Y)}else{I(Z)}}}}else{if(n.isHostMethod(N,"getRangeAt")&&typeof N.rangeCount=="number"){G=function(aa){if(h&&O&&aa.docSelection.type==W){v(aa)}else{aa._ranges.length=aa.rangeCount=aa.nativeSelection.rangeCount;if(aa.rangeCount){for(var Z=0,Y=aa.rangeCount;Z<Y;++Z){aa._ranges[Z]=new i.WrappedRange(aa.nativeSelection.getRangeAt(Z))}d(aa,aa._ranges[aa.rangeCount-1],t(aa.nativeSelection));aa.isCollapsed=p(aa)}else{I(aa)}}}}else{if(L&&typeof N.isCollapsed==F&&typeof D.collapsed==F&&i.features.implementsDomRange){G=function(aa){var Y,Z=aa.nativeSelection;if(Z.anchorNode){Y=q(Z,0);aa._ranges=[Y];aa.rangeCount=1;x(aa);aa.isCollapsed=p(aa)}else{I(aa)}}}else{f.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}c.refresh=function(Z){var Y=Z?this._ranges.slice(0):null;G(this);if(Z){var aa=Y.length;if(aa!=this._ranges.length){return false}while(aa--){if(!S.rangesEqual(Y[aa],this._ranges[aa])){return false}}return true}};var B=function(ac,aa){var Z=ac.getAllRanges(),ad=false;ac.removeAllRanges();for(var ab=0,Y=Z.length;ab<Y;++ab){if(ad||aa!==Z[ab]){ac.addRange(Z[ab])}else{ad=true}}if(!ac.rangeCount){I(ac)}};if(h){c.removeRange=function(ac){if(this.docSelection.type==W){var aa=this.docSelection.createRange();var Y=M(ac);var ag=e.getDocument(aa.item(0));var ae=e.getBody(ag).createControlRange();var Z,af=false;for(var ab=0,ad=aa.length;ab<ad;++ab){Z=aa.item(ab);if(Z!==Y||af){ae.add(aa.item(ab))}else{af=true}}ae.select();v(this)}else{B(this,ac)}}}else{c.removeRange=function(Y){B(this,Y)}}var t;if(!w&&L&&i.features.implementsDomRange){t=function(Z){var Y=false;if(Z.anchorNode){Y=(e.comparePoints(Z.anchorNode,Z.anchorOffset,Z.focusNode,Z.focusOffset)==1)}return Y};c.isBackwards=function(){return t(this)}}else{t=c.isBackwards=function(){return false}}c.toString=function(){var aa=[];for(var Z=0,Y=this.rangeCount;Z<Y;++Z){aa[Z]=""+this._ranges[Z]}return aa.join("")};function T(Z,Y){if(Z.anchorNode&&(e.getDocument(Z.anchorNode)!==e.getDocument(Y))){throw new P("WRONG_DOCUMENT_ERR")}}c.collapse=function(Z,aa){T(this,Z);var Y=i.createRange(e.getDocument(Z));Y.collapseToPoint(Z,aa);this.removeAllRanges();this.addRange(Y);this.isCollapsed=true};c.collapseToStart=function(){if(this.rangeCount){var Y=this._ranges[0];this.collapse(Y.startContainer,Y.startOffset)}else{throw new P("INVALID_STATE_ERR")}};c.collapseToEnd=function(){if(this.rangeCount){var Y=this._ranges[this.rangeCount-1];this.collapse(Y.endContainer,Y.endOffset)}else{throw new P("INVALID_STATE_ERR")}};c.selectAllChildren=function(Z){T(this,Z);var Y=i.createRange(e.getDocument(Z));Y.selectNodeContents(Z);this.removeAllRanges();this.addRange(Y)};c.deleteFromDocument=function(){if(h&&O&&this.docSelection.type==W){var ac=this.docSelection.createRange();var ab;while(ac.length){ab=ac.item(0);ac.remove(ab);ab.parentNode.removeChild(ab)}this.refresh()}else{if(this.rangeCount){var Z=this.getAllRanges();this.removeAllRanges();for(var aa=0,Y=Z.length;aa<Y;++aa){Z[aa].deleteContents()}this.addRange(Z[Y-1])}}};c.getAllRanges=function(){return this._ranges.slice(0)};c.setSingleRange=function(Y){this.setRanges([Y])};c.containsNode=function(ab,Z){for(var aa=0,Y=this._ranges.length;aa<Y;++aa){if(this._ranges[aa].containsNode(ab,Z)){return true}}return false};c.toHtml=function(){var ab="";if(this.rangeCount){var Z=S.getRangeDocument(this._ranges[0]).createElement("div");for(var aa=0,Y=this._ranges.length;aa<Y;++aa){Z.appendChild(this._ranges[aa].cloneContents())}ab=Z.innerHTML}return ab};function u(ae){var ad=[];var ab=new A(ae.anchorNode,ae.anchorOffset);var Z=new A(ae.focusNode,ae.focusOffset);var aa=(typeof ae.getName=="function")?ae.getName():"Selection";if(typeof ae.rangeCount!="undefined"){for(var ac=0,Y=ae.rangeCount;ac<Y;++ac){ad[ac]=S.inspect(ae.getRangeAt(ac))}}return"["+aa+"(Ranges: "+ad.join(", ")+")(anchor: "+ab.inspect()+", focus: "+Z.inspect()+"]"}c.getName=function(){return"WrappedSelection"};c.inspect=function(){return u(this)};c.detach=function(){this.win[V]=null;this.win=this.anchorNode=this.focusNode=null};C.inspect=u;i.Selection=C;i.selectionPrototype=c;i.addCreateMissingNativeApiListener(function(Y){if(typeof Y.getSelection=="undefined"){Y.getSelection=function(){return i.getSelection(this)}}Y=null})});var a=function(){};a.extend=function(d,g){var h=a.prototype.extend;a._prototyping=true;var f=new this;h.call(f,d);f.base=function(){};delete a._prototyping;var e=f.constructor;var c=f.constructor=function(){if(!a._prototyping){if(this._constructing||this.constructor==c){this._constructing=true;e.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||h).call(arguments[0],f)}}}};c.ancestor=this;c.extend=this.extend;c.forEach=this.forEach;c.implement=this.implement;c.prototype=f;c.toString=this.toString;c.valueOf=function(i){return(i=="object")?c:e.valueOf()};h.call(c,g);if(typeof c.init=="function"){c.init()}return c};a.prototype={extend:function(d,k){if(arguments.length>1){var g=this[d];if(g&&(typeof k=="function")&&(!g.valueOf||g.valueOf()!=k.valueOf())&&/\bbase\b/.test(k)){var c=k.valueOf();k=function(){var m=this.base||a.prototype.base;this.base=g;var i=c.apply(this,arguments);this.base=m;return i};k.valueOf=function(i){return(i=="object")?k:c};k.toString=a.toString}this[d]=k}else{if(d){var j=a.prototype.extend;if(!a._prototyping&&typeof this!="function"){j=this.extend||j}var f={toSource:null};var h=["constructor","toString","valueOf"];var e=a._prototyping?0:1;while(l=h[e++]){if(d[l]!=f[l]){j.call(this,l,d[l])}}for(var l in d){if(!f[l]){j.call(this,l,d[l])}}}}return this}};a=a.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(c,f,e){for(var d in c){if(this.prototype[d]===undefined){f.call(e,c[d],d,c)}}},implement:function(){for(var c=0;c<arguments.length;c++){if(typeof arguments[c]=="function"){arguments[c](this.prototype)}else{this.prototype.extend(arguments[c])}}return this},toString:function(){return String(this.valueOf())}});b.browser=(function(){var l=navigator.userAgent,g=document.createElement("div"),h=l.indexOf("MSIE")!==-1&&l.indexOf("Opera")===-1,e=l.indexOf("Gecko")!==-1&&l.indexOf("KHTML")===-1,i=l.indexOf("AppleWebKit/")!==-1,c=l.indexOf("Chrome/")!==-1,f=l.indexOf("Opera/")!==-1,d=l.indexOf("Firefox")!==-1;function k(m){return +((/ipad|iphone|ipod/.test(m)&&m.match(/ os (\d+).+? like mac os x/))||[,0])[1]}function j(m){return +(m.match(/android (\d+)/)||[,0])[1]}return{USER_AGENT:l,supported:function(){var o=this.USER_AGENT.toLowerCase(),q="contentEditable" in g,m=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,n=document.querySelector&&document.querySelectorAll,p=(this.isIos()&&k(o)<5)||(this.isAndroid()&&j(o)<4)||o.indexOf("opera mobi")!==-1||o.indexOf("hpwos/")!==-1;return q&&m&&n&&!p},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return(/ipad|iphone|ipod/i).test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return h},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return h},hasCurrentStyleProperty:function(){return"currentStyle" in g},hasHistoryIssue:function(){return e&&navigator.platform.substr(0,3)==="Mac"},insertsLineBreaksOnReturn:function(){return e},supportsPlaceholderAttributeOn:function(m){return"placeholder" in m},supportsEvent:function(m){return"on"+m in g||(function(){g.setAttribute("on"+m,"return;");return typeof(g["on"+m])==="function"})()},supportsEventsInIframeCorrectly:function(){return !f},supportsHTML5Tags:function(o){var n=o.createElement("div"),m="<article>foo</article>";n.innerHTML=m;return n.innerHTML.toLowerCase()===m},supportsCommand:(function(){var n={formatBlock:h,insertUnorderedList:h||i,insertOrderedList:h||i};var m={insertHTML:e};return function(p,r){var s=n[r];if(!s){try{return p.queryCommandSupported(r)}catch(q){}try{return p.queryCommandEnabled(r)}catch(o){return !!m[r]}}return false}})(),doesAutoLinkingInContentEditable:function(){return h},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return e||f||i},supportsGetAttributeCorrectly:function(){var m=document.createElement("td");return m.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return e||h||f},autoScrollsToCaret:function(){return !i},autoClosesUnclosedTags:function(){var o=g.cloneNode(false),m,n;o.innerHTML="<p><div></div>";n=o.innerHTML.toLowerCase();m=n==="<p></p><div></div>"||n==="<p><div></div></p>";this.autoClosesUnclosedTags=function(){return m};return m},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},needsSpaceAfterLineBreak:function(){return f},supportsSpeechApiOn:function(m){var n=l.match(/Chrome\/(\d+)/)||[,0];return n[1]>=11&&("onwebkitspeechchange" in m||"speech" in m)},crashesWhenDefineProperty:function(m){return h&&(m==="XMLHttpRequest"||m==="XDomainRequest")},doesAsyncFocus:function(){return h},hasProblemsSettingCaretAfterImg:function(){return h},hasUndoInContextMenu:function(){return e||c||f},hasInsertNodeIssue:function(){return f},hasIframeFocusIssue:function(){return h},createsNestedInvalidMarkupAfterPaste:function(){return i},detectsReturnKeydownAfterItIsDone:function(){return d}}})();b.lang.array=function(c){return{contains:function(f){if(c.indexOf){return c.indexOf(f)!==-1}else{for(var d=0,e=c.length;d<e;d++){if(c[d]===f){return true}}return false}},without:function(d){d=b.lang.array(d);var f=[],e=0,g=c.length;for(;e<g;e++){if(!d.contains(c[e])){f.push(c[e])}}return f},get:function(){var e=0,f=c.length,d=[];for(;e<f;e++){d.push(c[e])}return d}}};b.lang.Dispatcher=a.extend({on:function(c,d){this.events=this.events||{};this.events[c]=this.events[c]||[];this.events[c].push(d);return this},off:function(d,f){this.events=this.events||{};var e=0,c,g;if(d){c=this.events[d]||[],g=[];for(;e<c.length;e++){if(c[e]!==f&&f){g.push(c[e])}}this.events[d]=g}else{this.events={}}return this},fire:function(d,f){this.events=this.events||{};var c=this.events[d]||[],e=0;for(;e<c.length;e++){c[e].call(this,f)}return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}});b.lang.object=function(c){return{merge:function(d){for(var e in d){c[e]=d[e]}return this},get:function(){return c},clone:function(){var d={},e;for(e in c){d[e]=c[e]}return d},isArray:function(){return Object.prototype.toString.call(c)==="[object Array]"}}};(function(){var f=/^\s+/,e=/\s+$/,c=/[&<>"]/g,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};b.lang.string=function(g){g=String(g);return{trim:function(){return g.replace(f,"").replace(e,"")},interpolate:function(j){for(var h in j){g=this.replace("#{"+h+"}").by(j[h])}return g},replace:function(h){return{by:function(i){return g.split(h).join(i)}}},escapeHTML:function(){return g.replace(c,function(h){return d[h]})}}}})();(function(h){var s=h.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE","IFRAME"]),i=/((https?:\/\/|www\.)[^\s<]{3,}\.[^\s]{2,})/gi,p=/([^\w\/\-](,?))$/i,g=100,j={")":"(","]":"[","}":"{"};function e(v){if(n(v)){return v}if(v===v.ownerDocument.documentElement){v=v.ownerDocument.body}return c(v)}function f(v){return v.replace(i,function(z,y){var B=(y.match(p)||[])[1]||"",w=j[B];y=y.replace(p,"");if(y.split(w).length>y.split(B).length){y=y+B;B=""}var A=y,C=y;if(y.length>g){C=C.substr(0,g)+"..."}if(A.substr(0,4)==="www."){A="http://"+A}var x=u(A);if(!x){return'<a href="'+A+'">'+C+"</a>"+B}else{return k(A,x)}})}function l(v){return/(?:http|https|)(?::\/\/|)(?:www.|)(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[a-z0-9;:@?&%=+\/\$_.-]*/.test(v)?"youtube":false}function q(v){return/(http:\/\/)?((www\.)?|player\.)vimeo\.com/.test(v)?"vimeo":false}function t(v){return/(http:\/\/)?(dai\.ly\/[a-z0-9]+|(www\.)?dailymotion\.com\/(embed\/)?video\/[a-z0-9]+)/mi.test(v)?"daily":false}function u(v){return l(v)||t(v)}function d(y,w){var x={youtube:/(?:http|https|)(?::\/\/|)(?:www.|)(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/ytscreeningroom\?v=|\/feeds\/api\/videos\/|\/user\S*[^\w\-\s]|\S*[^\w\-\s]))([\w\-]{11})[a-z0-9;:@?&%=+\/\$_.-]*/,daily:/video\/[a-z0-9-]+|(?!\/)[a-z0-9]+(?=\?)|(?!\/)[a-z0-9]+([^=0-9])$/mi,vimeo:/[0-9]+(?=\?.+=.+|$)/mi};if(w=="youtube"){var v=1}else{var v=0}return y.match(x[w])[v].replace(/(embed\/|video\/|watch\?v\=)/,"")}function r(w,v){var x={youtube:"https://www.youtube.com/embed/{{VIDID}}",vimeo:"https://player.vimeo.com/video/{{VIDID}}?title=0&amp;byline=0&amp;portrait=0",daily:"https://www.dailymotion.com/embed/video/{{VIDID}}"};return x[w].replace("{{VIDID}}",v)}function k(x,w){var v=d(x,w);return'<iframe src="'+r(w,v)+'" width="496px" height="278px">'+r(w,v)+"</iframe>"}function o(w){var v=w._wysihtml5_tempElement;if(!v){v=w._wysihtml5_tempElement=w.createElement("div")}return v}function m(y){var w=y.parentNode,x=h.lang.string(y.data).escapeHTML(),v=o(w.ownerDocument);v.innerHTML="<span></span>"+f(x);v.removeChild(v.firstChild);while(v.firstChild){w.insertBefore(v.firstChild,y)}w.removeChild(y)}function n(v){var w;while(v.parentNode){v=v.parentNode;w=v.nodeName;if(s.contains(w)){return true}else{if(w==="body"){return false}}}return false}function c(w){if(s.contains(w.nodeName)){if(w.href&&u(w.href)){var z=w.href;h.dom.renameElement(w,"span");w.innerText=w.href}else{return}}if(w.nodeType===h.TEXT_NODE&&w.data.match(i)){m(w);return}var y=h.lang.array(w.childNodes).get(),x=y.length,v=0;for(;v<x;v++){c(y[v])}return w}h.dom.autoLink=e;h.dom.autoLink.URL_REG_EXP=i})(b);(function(d){var c=d.dom;c.addClass=function(e,f){var g=e.classList;if(g){return g.add(f)}if(c.hasClass(e,f)){return}e.className+=" "+f};c.removeClass=function(e,f){var g=e.classList;if(g){return g.remove(f)}e.className=e.className.replace(new RegExp("(^|\\s+)"+f+"(\\s+|$)")," ")};c.hasClass=function(e,f){var h=e.classList;if(h){return h.contains(f)}var g=e.className;return(g.length>0&&(g==f||new RegExp("(^|\\s)"+f+"(\\s|$)").test(g)))}})(b);b.dom.contains=(function(){var c=document.documentElement;if(c.contains){return function(d,e){if(e.nodeType!==b.ELEMENT_NODE){e=e.parentNode}return d!==e&&d.contains(e)}}else{if(c.compareDocumentPosition){return function(d,e){return !!(d.compareDocumentPosition(e)&16)}}}})();b.dom.convertToList=(function(){function d(h,g){var f=h.createElement("li");g.appendChild(f);return f}function e(g,f){return g.createElement(f)}function c(h,p){if(h.nodeName==="UL"||h.nodeName==="OL"||h.nodeName==="MENU"){return h}var r=h.ownerDocument,m=e(r,p),n=h.querySelectorAll("br"),l=n.length,t,s,f,o,k,u,j,q,g;for(g=0;g<l;g++){o=n[g];while((k=o.parentNode)&&k!==h&&k.lastChild===o){if(b.dom.getStyle("display").from(k)==="block"){k.removeChild(o);break}b.dom.insert(o).after(o.parentNode)}}t=b.lang.array(h.childNodes).get();s=t.length;for(g=0;g<s;g++){q=q||d(r,m);f=t[g];u=b.dom.getStyle("display").from(f)==="block";j=f.nodeName==="BR";if(u){q=q.firstChild?d(r,m):q;q.appendChild(f);q=null;continue}if(j){q=q.firstChild?null:q;continue}q.appendChild(f)}if(t.length===0){d(r,m)}h.parentNode.replaceChild(m,h);return m}return c})();b.dom.copyAttributes=function(c){return{from:function(d){return{to:function(e){var h,f=0,g=c.length;for(;f<g;f++){h=c[f];if(typeof(d[h])!=="undefined"&&d[h]!==""){e[h]=d[h]}}return{andTo:arguments.callee}}}}}};(function(d){var f=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];var e=function(g){if(c(g)){return parseInt(d.getStyle("width").from(g),10)<g.offsetWidth}return false};var c=function(h){var g=0,j=f.length;for(;g<j;g++){if(d.getStyle(f[g]).from(h)==="border-box"){return f[g]}}};d.copyStyles=function(g){return{from:function(j){if(e(j)){g=b.lang.array(g).without(f)}var k="",l=g.length,h=0,m;for(;h<l;h++){m=g[h];k+=m+":"+d.getStyle(m).from(j)+";"}return{to:function(i){d.setStyles(k).on(i);return{andTo:arguments.callee}}}}}}})(b.dom);(function(c){c.dom.delegate=function(e,d,f,g){return c.dom.observe(e,f,function(i){var j=i.target,h=c.lang.array(e.querySelectorAll(d));while(j&&j!==e){if(h.contains(j)){g.call(j,i);break}j=j.parentNode}})}})(b);b.dom.getAsDom=(function(){var c=function(h,g){var f=g.createElement("div");f.style.display="none";g.body.appendChild(f);try{f.innerHTML=h}catch(i){}g.body.removeChild(f);return f};var e=function(g){if(g._wysihtml5_supportsHTML5Tags){return}for(var f=0,h=d.length;f<h;f++){g.createElement(d[f])}g._wysihtml5_supportsHTML5Tags=true};var d=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(h,g){g=g||document;var f;if(typeof(h)==="object"&&h.nodeType){f=g.createElement("div");f.appendChild(h)}else{if(b.browser.supportsHTML5Tags(g)){f=g.createElement("div");f.innerHTML=h}else{e(g);f=c(h,g)}}return f}})();b.dom.getParentElement=(function(){function c(i,h){if(!h||!h.length){return true}if(typeof(h)==="string"){return i===h}else{return b.lang.array(h).contains(i)}}function e(h){return h.nodeType===b.ELEMENT_NODE}function d(h,i,j){var k=(h.className||"").match(j)||[];if(!i){return !!k.length}return k[k.length-1]===i}function g(h,j,i){while(i--&&h&&h.nodeName!=="BODY"){if(c(h.nodeName,j)){return h}h=h.parentNode}return null}function f(i,l,h,k,j){while(j--&&i&&i.nodeName!=="BODY"){if(e(i)&&c(i.nodeName,l)&&d(i,h,k)){return i}i=i.parentNode}return null}return function(i,h,j){j=j||50;if(h.className||h.classRegExp){return f(i,h.nodeName,h.className,h.classRegExp,j)}else{return g(i,h.nodeName,j)}}})();b.dom.getStyle=(function(){var d={"float":("styleFloat" in document.createElement("div").style)?"styleFloat":"cssFloat"},e=/\-[a-z]/g;function c(f){return f.replace(e,function(g){return g.charAt(1).toUpperCase()})}return function(f){return{from:function(k){if(k.nodeType!==b.ELEMENT_NODE){return}var p=k.ownerDocument,l=d[f]||c(f),h=k.style,i=k.currentStyle,q=h[l];if(q){return q}if(i){try{return i[l]}catch(n){}}var m=p.defaultView||p.parentWindow,o=(f==="height"||f==="width")&&k.nodeName==="TEXTAREA",j,g;if(m.getComputedStyle){if(o){j=h.overflow;h.overflow="hidden"}g=m.getComputedStyle(k,null).getPropertyValue(f);if(o){h.overflow=j||""}return g}}}}})();b.dom.hasElementWithTagName=(function(){var e={},d=1;function c(f){return f._wysihtml5_identifier||(f._wysihtml5_identifier=d++)}return function(h,g){var f=c(h)+":"+g,i=e[f];if(!i){i=e[f]=h.getElementsByTagName(g)}return i.length>0}})();(function(f){var e={},d=1;function c(g){return g._wysihtml5_identifier||(g._wysihtml5_identifier=d++)}f.dom.hasElementWithClassName=function(i,h){if(!f.browser.supportsNativeGetElementsByClassName()){return !!i.querySelector("."+h)}var g=c(i)+":"+h,j=e[g];if(!j){j=e[g]=i.getElementsByClassName(h)}return j.length>0}})(b);b.dom.insert=function(c){return{after:function(d){d.parentNode.insertBefore(c,d.nextSibling)},before:function(d){d.parentNode.insertBefore(c,d)},into:function(d){d.appendChild(c)}}};b.dom.insertCSS=function(c){c=c.join("\n");return{into:function(g){var d=g.createElement("style");d.type="text/css";if(d.styleSheet){d.styleSheet.cssText=c}else{d.appendChild(g.createTextNode(c))}var f=g.querySelector("head link");if(f){f.parentNode.insertBefore(d,f);return}else{var e=g.querySelector("head");if(e){e.appendChild(d)}}}}};b.dom.observe=function(e,j,f){j=typeof(j)==="string"?[j]:j;var h,c,d=0,g=j.length;for(;d<g;d++){c=j[d];if(e.addEventListener){e.addEventListener(c,f,false)}else{h=function(i){if(!("target" in i)){i.target=i.srcElement}i.preventDefault=i.preventDefault||function(){this.returnValue=false};i.stopPropagation=i.stopPropagation||function(){this.cancelBubble=true};f.call(e,i)};e.attachEvent("on"+c,h)}}return{stop:function(){var k,l=0,m=j.length;for(;l<m;l++){k=j[l];if(e.removeEventListener){e.removeEventListener(k,f,false)}else{e.detachEvent("on"+k,h)}}}}};b.dom.parse=(function(){var z="_wysihtml5-temp-placeholder";var v=new RegExp("<img|<iframe|<video|<hr|<canvas","i");var f=new RegExp("img|iframe|video|hr|canvas|br");var t=["A","B","I","U","SPAN","#text","IMG","EM","STRONG"];parent=this.parent;function p(C){switch(C.nodeType){case b.DOC_FRAGMENT_NODE:var B=true;for(var A=0;A<C.childNodes.length;A++){B=B&&p(C.childNodes[A])}return B;case b.ELEMENT_NODE:if(C.getAttribute("class")==z){return false}var E=C.innerHTML;var D=b.dom.getTextContent(C);return(!f.test(C.nodeName.toLowerCase()))&&(D.replace(/\s/g,"").length==0)&&(E!==undefined&&!v.test(E));case b.TEXT_NODE:return false}}var r={"1":l,"3":k},c="span",u=/\s+/,o={tags:{},classes:{},fix:[],deny:[],parser:[]},g={};function m(A,B){A.insertBefore(B,A.firstChild)}function q(A,C){var B=A.ownerDocument.createElement(C);A.parentNode.insertBefore(B,A);while(A.nextSibling&&t.indexOf(A.nextSibling.nodeName)>=0){B.appendChild(A.nextSibling)}m(B,A);return B}function s(G,J,B,D){b.lang.object(g).merge(o).merge(J).get();B=B||G.ownerDocument||document;var F=B.createDocumentFragment(),C=typeof(G)==="string",E,I,H;if(C){E=b.dom.getAsDom(G,B)}else{E=G}if(typeof J==="object"&&J.root_text_nodes&&(E.nodeName=="BODY"||E.nodeName=="BLOCKQUOTE"||!E.parentNode)){var A=function(K){if(t.indexOf(K.nodeName)>=0){return q(K,J.root_text_nodes)}else{return K}}}else{var A=function(K){return K}}while(E.firstChild){H=A(E.firstChild);I=x(H,D);E.removeChild(H);if(I&&!p(I)){F.appendChild(I)}}E.innerHTML="";E.appendChild(F);if(typeof J==="object"){if(J.selectors){E.innerHTML=b.dom.selectorParser.parse(E,J.selectors)}if(J.parser){E.innerHTML=b.dom.textParser.parse(E,J.parser,J.preserve)}}return C?b.quirks.getCorrectInnerHTML(E):E}function x(C,B){var I=C.nodeType,H=C.childNodes,F=H.length,A=r[I],D=0,G,J,E;J=A&&A(C);if(!J){return null}if(J.nodeName=="BLOCKQUOTE"){for(D=0;D<F;D++){if(t.indexOf(H[D].nodeName)>=0){q(H[D],g.root_text_nodes);H=C.childNodes;F=H.length}}}for(D=0;D<F;D++){E=x(H[D],B);if(E&&!p(E)){J.appendChild(E)}}if(B&&J.nodeName.toLowerCase()===c&&(!J.childNodes.length||!J.attributes.length)){G=J.ownerDocument.createDocumentFragment();while(J.firstChild){G.appendChild(J.firstChild)}return G}return J}function l(E){var D,C,B=g.tags,F=E.nodeName.toLowerCase(),A=E.scopeName;if(E._wysihtml5){return null}E._wysihtml5=1;if(E.className==="wysihtml5-temp"){return null}if(A&&A!="HTML"){F=A+":"+F}if("outerHTML" in E){if(!b.browser.autoClosesUnclosedTags()&&E.nodeName==="P"&&E.outerHTML.slice(-4).toLowerCase()!=="</p>"){F="div"}}if(F in B){D=B[F];if(!D||D.remove){return null}D=typeof(D)==="string"?{rename_tag:D}:D}else{if(E.firstChild){D={rename_tag:c}}else{return null}}C=E.ownerDocument.createElement(D.rename_tag||F);j(E,C,D);E=null;return C}function j(N,A,G){var J={},U=G.set_class,L=G.add_class,Q=G.set_attributes,F=G.check_attributes,E=g.classes,P=0,S=[],V=[],D=[],O=[],H,K,C,I,M,T,B;if(Q){J=b.lang.object(Q).clone()}if(F){for(M in F){B=w[F[M]];if(!B){continue}T=B(e(N,M));if(typeof(T)==="string"){J[M]=T}}}if(U){S.push(U)}if(L){for(M in L){B=y[L[M]];if(!B){continue}I=B(e(N,M));if(typeof(I)==="string"){S.push(I)}}}E[z]=1;O=N.getAttribute("class");if(O){S=S.concat(O.split(u))}H=S.length;for(;P<H;P++){C=S[P];if(E[C]){V.push(C)}}K=V.length;while(K--){C=V[K];if(!b.lang.array(D).contains(C)){D.unshift(C)}}if(D.length){J["class"]=D.join(" ")}for(M in J){try{A.setAttribute(M,J[M])}catch(R){}}if(J.src){if(typeof(J.width)!=="undefined"){A.setAttribute("width",J.width)}if(typeof(J.height)!=="undefined"){A.setAttribute("height",J.height)}}}var i=!b.browser.supportsGetAttributeCorrectly();function e(C,B){B=B.toLowerCase();var E=C.nodeName;if(E=="IMG"&&B=="src"&&n(C)===true){return C.src}else{if(i&&"outerHTML" in C){var D=C.outerHTML.toLowerCase(),A=D.indexOf(" "+B+"=")!=-1;return A?C.getAttribute(B):null}else{return C.getAttribute(B)}}}function n(A){try{return A.complete&&!A.mozMatchesSelector(":-moz-broken")}catch(B){if(A.complete&&A.readyState==="complete"){return true}}}function d(B,A){return(g.tags[B]&&g.tags[B].parse&&g.tags[B].parse(A))||A}var h=/\uFEFF/g;function k(C){var B=C.nextSibling;if(B&&B.nodeType===b.TEXT_NODE&&B.nodeName!=="br"){B.data=C.data+B.data}else{var A=C.data.replace(h,"");return C.ownerDocument.createTextNode(d(C.parentNode.nodeName.toLowerCase(),A))}}var w={url:(function(){var A=/^https?:\/\//i;return function(B){if(!B||!B.match(A)){return null}return B.replace(A,function(C){return C.toLowerCase()})}})(),src:(function(){var A=/^(\/|https?:\/\/)/i;return function(B){if(!B||!B.match(A)){return null}return B.replace(A,function(C){return C.toLowerCase()})}})(),href:(function(){var A=/^(\/|https?:\/\/|mailto:)/i;return function(B){if(!B||!B.match(A)){return null}return B.replace(A,function(C){return C.toLowerCase()})}})(),alt:(function(){var A=/[^ a-z0-9_\-]/gi;return function(B){if(!B){return""}return B.replace(A,"")}})(),numbers:(function(){var A=/\D/g;return function(B){B=(B||"").replace(A,"");return B||null}})()};var y={align_img:(function(){var A={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(B){return A[String(B).toLowerCase()]}})(),align_text:(function(){var A={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(B){return A[String(B).toLowerCase()]}})(),clear_br:(function(){var A={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(B){return A[String(B).toLowerCase()]}})(),size_font:(function(){var A={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(B){return A[String(B).charAt(0)]}})()};return s})();b.dom.removeEmptyTextNodes=function(e){var d,g=b.lang.array(e.childNodes).get(),f=g.length,c=0;for(;c<f;c++){d=g[c];if(d.nodeType===b.TEXT_NODE&&d.data===""){d.parentNode.removeChild(d)}}};b.dom.renameElement=function(c,d){var f=c.ownerDocument.createElement(d),e;while(e=c.firstChild){f.appendChild(e)}b.dom.copyAttributes(["align","className"]).from(c).to(f);c.parentNode.replaceChild(f,c);return f};b.dom.replaceWithChildNodes=function(d){if(!d.parentNode){return}if(!d.firstChild){d.parentNode.removeChild(d);return}var c=d.ownerDocument.createDocumentFragment();while(d.firstChild){c.appendChild(d.firstChild)}d.parentNode.replaceChild(c,d);d=c=null};(function(g){function e(h){return g.getStyle("display").from(h)==="block"}function f(h){return h.nodeName==="BR"}function d(i){var h=i.ownerDocument.createElement("br");i.appendChild(h)}function c(n,q){if(!n.nodeName.match(/^(MENU|UL|OL)$/)){return}var r=n.ownerDocument,o=r.createDocumentFragment(),i=n.previousElementSibling||n.previousSibling,p,j,k,l,m,h;if(q){if(i&&!e(i)){d(o)}while(h=(n.firstElementChild||n.firstChild)){j=h.lastChild;while(p=h.firstChild){k=p===j;l=k&&!e(p)&&!f(p);o.appendChild(p);if(l){d(o)}}h.parentNode.removeChild(h)}}else{while(h=(n.firstElementChild||n.firstChild)){if(h.querySelector&&h.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6")){while(p=h.firstChild){o.appendChild(p)}}else{m=r.createElement("p");while(p=h.firstChild){m.appendChild(p)}o.appendChild(m)}h.parentNode.removeChild(h)}}n.parentNode.replaceChild(o,n)}g.resolveList=c})(b.dom);(function(g){var f=document,e=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],c=["referrer","write","open","close"];g.dom.Sandbox=a.extend({constructor:function(i,h){this.callback=i||g.EMPTY_FUNCTION;this.config=g.lang.object({}).merge(h).get();this.iframe=this._createIframe()},insertInto:function(h){if(typeof(h)==="string"){h=f.getElementById(h)}h.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var h=this.getIframe();h.parentNode.removeChild(h)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var i=this,h=f.createElement("iframe");h.className="wysihtml5-sandbox";g.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(h);if(g.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()){h.src="javascript:'<html></html>'"}h.onload=function(){h.onreadystatechange=h.onload=null;i._onLoadIframe(h)};h.onreadystatechange=function(){if(/loaded|complete/.test(h.readyState)){h.onreadystatechange=h.onload=null;i._onLoadIframe(h)}};return h},_onLoadIframe:function(k){if(!g.dom.contains(f.documentElement,k)){return}var n=this,h=k.contentWindow,o=k.contentWindow.document,p=f.characterSet||f.charset||"utf-8",m=this._getHtml({charset:p,stylesheets:this.config.stylesheets});o.open("text/html","replace");o.write(m);o.close();this.getWindow=function(){return k.contentWindow};this.getDocument=function(){return k.contentWindow.document};h.onerror=function(q,r,i){throw new Error("wysihtml5.Sandbox: "+q,r,i)};if(!g.browser.supportsSandboxedIframes()){var j,l;for(j=0,l=e.length;j<l;j++){this._unset(h,e[j])}for(j=0,l=d.length;j<l;j++){this._unset(h,d[j],g.EMPTY_FUNCTION)}for(j=0,l=c.length;j<l;j++){this._unset(o,c[j])}this._unset(o,"cookie","",true)}this.loaded=true;setTimeout(function(){n.callback(n)},0)},_getHtml:function(l){var m=l.stylesheets,j="",h=0,k;m=typeof(m)==="string"?[m]:m;if(m){k=m.length;for(;h<k;h++){j+='<link rel="stylesheet" href="'+m[h]+'">'}}l.stylesheets=j;return g.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(l)},_unset:function(i,k,j,m){try{i[k]=j}catch(l){}try{i.__defineGetter__(k,function(){return j})}catch(l){}if(m){try{i.__defineSetter__(k,function(){})}catch(l){}}if(!g.browser.crashesWhenDefineProperty(k)){try{var h={get:function(){return j}};if(m){h.set=function(){}}Object.defineProperty(i,k,h)}catch(l){}}}})})(b);(function(){var c={className:"class"};b.dom.setAttributes=function(d){return{on:function(f){for(var e in d){f.setAttribute(c[e]||e,d[e])}}}}})();b.dom.setStyles=function(c){return{on:function(e){var f=e.style;if(typeof(c)==="string"){f.cssText+=";"+c;return}for(var d in c){if(d==="float"){f.cssFloat=c[d];f.styleFloat=c[d]}else{f[d]=c[d]}}}}};(function(c){c.simulatePlaceholder=function(f,d,e){var g="placeholder",h=function(){if(d.hasPlaceholderSet()){d.clear()}d.placeholderSet=false;c.removeClass(d.element,g)},i=function(){if(d.isEmpty()){d.placeholderSet=true;d.setValue(e);c.addClass(d.element,g)}};f.on("set_placeholder",i).on("unset_placeholder",h).on("focus:composer",h).on("paste:composer",h).on("blur:composer",i);i()}})(b.dom);(function(d){var c=document.documentElement;if("textContent" in c){d.setTextContent=function(e,f){e.textContent=f};d.getTextContent=function(e){return e.textContent}}else{if("innerText" in c){d.setTextContent=function(e,f){e.innerText=f};d.getTextContent=function(e){return e.innerText}}else{d.setTextContent=function(e,f){e.nodeValue=f};d.getTextContent=function(e){return e.nodeValue}}}})(b.dom);b.dom.replaceAndBecomeChild=function(e,d){if(!e.parentNode){return}var c=e.parentNode;c.replaceChild(d,e);d.appendChild(e);return d};b.dom.textParser={};b.dom.textParser.TEXT_PLACEMENT_MARKUP="__#txt__";b.dom.textParser.TEXT_PLACEMENT_MARKUP_REGEX=new RegExp(b.dom.textParser.TEXT_PLACEMENT_MARKUP+"$","gi");b.dom.textParser.PRESERVE_MARKUP="{{__PRESERVE__}}";b.dom.textParser.fold=function(e,c,d){return(e&&e.length>0)?this.fold(e.slice(1,e.length),d(c,e[0]),d):c};b.dom.textParser.processNode=function(e,d,c){switch(e.nodeType){case 1:return d(e);case 3:return c(e)}};b.dom.textParser.extractText=function(e,c){var d=this;return d.processNode(e,function(g){var j=[].slice.call(g.childNodes,0);var h="";for(var f=0;f<j.length;f++){h+=d.extractText(j[f],c)}return h},function(f){return d.preserveMarkup(f.textContent,c)+d.TEXT_PLACEMENT_MARKUP})};b.dom.textParser.preserveMarkup=function(d,c){return c!==undefined?d.replace(c,this.PRESERVE_MARKUP):d};b.dom.textParser.extractPreserved=function(e,c){var d=this;return d.processNode(e,function(h){var f=[];var j=[].slice.call(h.childNodes,0);for(var g=0;g<j.length;g++){f=f.concat(d.extractPreserved(j[g],c))}return f},function(f){if(c){c.lastIndex=0;return c.test(f.textContent)?f.textContent.match(c):[]}return[]})};b.dom.textParser.extractNodeMarkup=function(d){var c=this;return c.processNode(d,function(e){return c.getNodeMarkupGuts(e)},function(e){return c.TEXT_PLACEMENT_MARKUP})};b.dom.textParser.getNodeMarkupGuts=function(e){var d=this,c=e.attributes.length>0?e.outerHTML.match(/ .*?(?=>)/)[0]:"";return !e.firstChild?"<"+e.nodeName.toLowerCase()+c+">":"<"+e.nodeName.toLowerCase()+c+">"+(function(){var h=[].slice.call(e.childNodes,0);var g="";for(var f=0;f<h.length;f++){g+=d.extractNodeMarkup(h[f])}return g})()+"</"+e.nodeName.toLowerCase()+">"};b.dom.textParser.replacePreserved=function(c,f){var e=this;for(var d=0;d<c.length;d++){f=f.replace(e.PRESERVE_MARKUP,c[d])}return f};b.dom.textParser.applyRules=function(f,e){var d=this;for(var c=0;c<e.length;c++){f=f.replace(e[c].rule,e[c].replace)}return f};b.dom.textParser.parse=function(c,m,k){var f=this;var l="";var o=[];var h="";var n=[].slice.call(c.childNodes,0);for(var e=0;e<n.length;e++){l+=f.extractNodeMarkup(n[e]);o=o.concat(f.extractPreserved(n[e],k));h+=f.extractText(n[e],k)}var g=f.applyRules(h.replace(f.TEXT_PLACEMENT_MARKUP_REGEX,""),m).split(f.TEXT_PLACEMENT_MARKUP);for(var d=0;d<g.length;d++){l=l.replace(f.TEXT_PLACEMENT_MARKUP,g[d])}return b.dom.textParser.replacePreserved(o,l)};b.dom.selectorParser={};b.dom.selectorParser.parse=(function(){var c=b.dom.selectorParser;c._actions={};c._actions.rename_tag=function(f,e){return b.dom.renameElement(f,e)};c._actions.remove=function(e,f){if(oldElement.parentNode){oldElement.parentNode.removeChild(oldElement)}};c._convertToFragment=function(e){var f=e.ownerDocument.createDocumentFragment();f.appendChild(e.cloneNode(true));return f};function d(g,l){var m=c._convertToFragment(g);for(var j in l){var f=m.querySelectorAll(j);for(var e=f.length-1;e>=0;e--){var k=f[e];for(var h in l[j]){c._actions[h](k,l[j][h])}}}return m.firstChild.innerHTML}return d})();b.quirks.cleanPastedHTML=(function(){var c={a:function(e){if(!e.href||e.href===""){e.outerHTML=e.innerHTML}},"a u":b.dom.replaceWithChildNodes};function d(n,o,f){o=o||c;f=f||n.ownerDocument||document;var l,g=typeof(n)==="string",e,m,p,k,h=0;if(g){l=b.dom.getAsDom(n,f)}else{l=n}for(k in o){m=l.querySelectorAll(k);e=o[k];p=m.length;for(;h<p;h++){e(m[h])}}m=n=o=null;return g?l.innerHTML:l}return d})();b.quirks.ensureProperClearing=(function(){var c=function(){var d=this;setTimeout(function(){var e=d.innerHTML.toLowerCase();if(e=="<p>&nbsp;</p>"||e=="<p>&nbsp;</p><p>&nbsp;</p>"){d.innerHTML=""}},0)};return function(d){b.dom.observe(d.element,["cut","keydown"],c)}})();(function(d){var c="%7E";d.quirks.getCorrectInnerHTML=function(g){var l=g.innerHTML;if(l.indexOf(c)===-1){return l}var j=g.querySelectorAll("[href*='~'], [src*='~']"),e,k,h,f;for(f=0,h=j.length;f<h;f++){e=j[f].href||j[f].src;k=d.lang.string(e).replace("~").by(c);l=d.lang.string(l).replace(k).by(e)}return l}})(b);(function(d){var c="wysihtml5-quirks-redraw";d.quirks.redraw=function(f){d.dom.addClass(f,c);d.dom.removeClass(f,c);try{var h=f.ownerDocument;h.execCommand("italic",false,null);h.execCommand("italic",false,null)}catch(g){}}})(b);(function(e){var d=e.dom;function c(f){var g=0;if(f.parentNode){do{g+=f.offsetTop||0;f=f.offsetParent}while(f)}return g}e.Selection=a.extend({constructor:function(f){window.rangy.init();this.editor=f;this.composer=f.composer;this.doc=this.composer.doc},getBookmark:function(){var f=this.getRange();return f&&f.cloneRange()},setBookmark:function(f){if(!f){return}this.setSelection(f)},setBefore:function(g){var f=rangy.createRange(this.doc);f.setStartBefore(g);f.setEndBefore(g);return this.setSelection(f)},setAfter:function(g){var f=rangy.createRange(this.doc);f.setStartAfter(g);f.setEndAfter(g);return this.setSelection(f)},selectNode:function(f,l){var h=rangy.createRange(this.doc),k=f.nodeType===e.ELEMENT_NODE,n="canHaveHTML" in f?f.canHaveHTML:(f.nodeName!=="IMG"),j=k?f.innerHTML:f.data,g=(j===""||j===e.INVISIBLE_SPACE),m=d.getStyle("display").from(f),o=(m==="block"||m==="list-item");if(g&&k&&n&&!l){try{f.innerHTML=e.INVISIBLE_SPACE}catch(i){}}if(n){h.selectNodeContents(f)}else{h.selectNode(f)}if(n&&g&&k){h.collapse(o)}else{if(n&&g){h.setStartAfter(f);h.setEndAfter(f)}}this.setSelection(h)},getSelectedNode:function(g){var h,f;if(g&&this.doc.selection&&this.doc.selection.type==="Control"){f=this.doc.selection.createRange();if(f&&f.length){return f.item(0)}}h=this.getSelection(this.doc);if(h.focusNode===h.anchorNode){return h.focusNode}else{f=this.getRange(this.doc);return f?f.commonAncestorContainer:this.doc.body}},executeAndRestore:function(g,u){var n=this.doc.body,k=u&&n.scrollTop,p=u&&n.scrollLeft,r="_wysihtml5-temp-placeholder",l='<span class="'+r+'">'+e.INVISIBLE_SPACE+"</span>",m=this.getRange(this.doc),f,h,j,i,t;if(!m){g(n,n);return}if(e.browser.hasInsertNodeIssue()){this.doc.execCommand("insertHTML",false,l)}else{i=m.createContextualFragment(l);m.insertNode(i)}try{g(m.startContainer,m.endContainer)}catch(q){setTimeout(function(){throw q},0)}f=this.doc.querySelector("."+r);if(f){t=rangy.createRange(this.doc);j=f.nextSibling;if(e.browser.hasInsertNodeIssue()&&j&&j.nodeName==="BR"){h=this.doc.createTextNode(e.INVISIBLE_SPACE);d.insert(h).after(f);t.setStartBefore(h);t.setEndBefore(h)}else{var o=f.textContent;if(o!==""&&o!==e.INVISIBLE_SPACE){f.outerHTML=d.parse(f,this.composer.config.parserRules).innerHTML}t.selectNode(f);t.deleteContents()}this.setSelection(t)}else{n.focus()}if(u){n.scrollTop=k;n.scrollLeft=p}try{f.parentNode.removeChild(f)}catch(s){}},executeAndRestoreSimple:function(f){var i=this.getRange(),j=this.doc.body,q,g,h,m,k;if(!i){f(j,j);return}m=i.getNodes([3]);g=m[0]||i.startContainer;h=m[m.length-1]||i.endContainer;k={collapsed:i.collapsed,startContainer:g,startOffset:g===i.startContainer?i.startOffset:0,endContainer:h,endOffset:h===i.endContainer?i.endOffset:h.length};try{f(i.startContainer,i.endContainer)}catch(l){setTimeout(function(){throw l},0)}q=rangy.createRange(this.doc);try{q.setStart(k.startContainer,k.startOffset)}catch(p){}try{q.setEnd(k.endContainer,k.endOffset)}catch(o){}try{this.setSelection(q)}catch(n){}},set:function(g,h){var f=rangy.createRange(this.doc);f.setStart(g,h||0);this.setSelection(f)},insertHTML:function(g){var f=rangy.createRange(this.doc),i=f.createContextualFragment(g),h=i.lastChild;this.insertNode(i);if(h){this.setAfter(h)}},insertNode:function(g){var f=this.getRange();if(f){f.insertNode(g)}},surround:function(g){var f=this.getRange();if(!f){return}try{f.surroundContents(g);this.selectNode(g)}catch(h){g.appendChild(f.extractContents());f.insertNode(g)}},scrollIntoView:function(){var j=this.doc,g=5,i=j.documentElement.scrollHeight>j.documentElement.offsetHeight,f=j._wysihtml5ScrollIntoViewElement=j._wysihtml5ScrollIntoViewElement||(function(){var k=j.createElement("span");k.innerHTML=e.INVISIBLE_SPACE;return k})(),h;if(i){this.insertNode(f);h=c(f);f.parentNode.removeChild(f);if(h>=(j.body.scrollTop+j.documentElement.offsetHeight-g)){j.body.scrollTop=h}}},selectLine:function(){if(e.browser.supportsSelectionModify()){this._selectLine_W3C()}else{if(this.doc.selection){this._selectLine_MSIE()}}},_selectLine_W3C:function(){var g=this.doc.defaultView,f=g.getSelection();f.modify("extend","left","lineboundary");f.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var n=this.doc.selection.createRange(),l=n.boundingTop,m=this.doc.body.scrollWidth,g,f,o,k,h;if(!n.moveToPoint){return}if(l===0){o=this.doc.createElement("span");this.insertNode(o);l=o.offsetTop;o.parentNode.removeChild(o)}l+=1;for(k=-10;k<m;k+=2){try{n.moveToPoint(k,l);break}catch(q){}}g=l;f=this.doc.selection.createRange();for(h=m;h>=0;h--){try{f.moveToPoint(h,g);break}catch(p){}}n.setEndPoint("EndToEnd",f);n.select()},getText:function(){var f=this.getSelection();return f?f.toString():""},getNodes:function(f,h){var g=this.getRange();if(g){return g.getNodes([f],h)}else{return[]}},getRange:function(){var f=this.getSelection();return f&&f.rangeCount&&f.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(f){var h=this.doc.defaultView||this.doc.parentWindow,g=rangy.getSelection(h);return g.setSingleRange(f)}})})(b);(function(p,l){var j="span";var h=/\s+/g;function f(s,q,r){if(!s.className){return false}var t=s.className.match(r)||[];return t[t.length-1]===q}function k(s,q,r){if(s.className){n(s,r);s.className+=" "+q}else{s.className=q}}function n(r,q){if(r.className){r.className=r.className.replace(q,"")}}function o(r,q){return r.className.replace(h," ")==q.className.replace(h," ")}function c(r){var q=r.parentNode;while(r.firstChild){q.insertBefore(r.firstChild,r)}q.removeChild(r)}function g(w,u){if(w.attributes.length!=u.attributes.length){return false}for(var v=0,q=w.attributes.length,t,r,s;v<q;++v){t=w.attributes[v];s=t.name;if(s!="class"){r=u.attributes.getNamedItem(s);if(t.specified!=r.specified){return false}if(t.specified&&t.nodeValue!==r.nodeValue){return false}}}return true}function e(q,r){if(l.dom.isCharacterDataNode(q)){if(r==0){return !!q.previousSibling}else{if(r==q.length){return !!q.nextSibling}else{return true}}}return r>0&&r<q.childNodes.length}function d(t,r,s){var q;if(l.dom.isCharacterDataNode(r)){if(s==0){s=l.dom.getNodeIndex(r);r=r.parentNode}else{if(s==r.length){s=l.dom.getNodeIndex(r)+1;r=r.parentNode}else{q=l.dom.splitDataNode(r,s)}}}if(!q){q=r.cloneNode(false);if(q.id){q.removeAttribute("id")}var u;while((u=r.childNodes[s])){q.appendChild(u)}l.dom.insertAfter(q,r)}return(r==t)?q:d(t,q.parentNode,l.dom.getNodeIndex(q))}function i(q){this.isElementMerge=(q.nodeType==p.ELEMENT_NODE);this.firstTextNode=this.isElementMerge?q.lastChild:q;this.textNodes=[this.firstTextNode]}i.prototype={doMerge:function(){var v=[],u,s,t;for(var r=0,q=this.textNodes.length;r<q;++r){u=this.textNodes[r];s=u.parentNode;v[r]=u.data;if(r){s.removeChild(u);if(!s.hasChildNodes()){s.parentNode.removeChild(s)}}}this.firstTextNode.data=t=v.join("");return t},getLength:function(){var r=this.textNodes.length,q=0;while(r--){q+=this.textNodes[r].length}return q},toString:function(){var s=[];for(var r=0,q=this.textNodes.length;r<q;++r){s[r]="'"+this.textNodes[r].data+"'"}return"[Merge("+s.join(",")+")]"}};function m(q,s,r,t){this.tagNames=q||[j];this.cssClass=s||"";this.similarClassRegExp=r;this.normalize=t;this.applyToAnyTagName=false}m.prototype={getAncestorWithClass:function(r){var q;while(r){q=this.cssClass?f(r,this.cssClass,this.similarClassRegExp):true;if(r.nodeType==p.ELEMENT_NODE&&l.dom.arrayContains(this.tagNames,r.tagName.toLowerCase())&&q){return r}r=r.parentNode}return false},postApply:function(C,y){var q=C[0],r=C[C.length-1];var t=[],D;var v=q,s=r;var A=0,E=r.length;var u,x;for(var w=0,z=C.length;w<z;++w){u=C[w];x=this.getAdjacentMergeableTextNode(u.parentNode,false);if(x){if(!D){D=new i(x);t.push(D)}D.textNodes.push(u);if(u===q){v=D.firstTextNode;A=v.length}if(u===r){s=D.firstTextNode;E=D.getLength()}}else{D=null}}var B=this.getAdjacentMergeableTextNode(r.parentNode,true);if(B){if(!D){D=new i(r);t.push(D)}D.textNodes.push(B)}if(t.length){for(w=0,z=t.length;w<z;++w){t[w].doMerge()}y.setStart(v,A);y.setEnd(s,E)}},getAdjacentMergeableTextNode:function(s,q){var u=(s.nodeType==p.TEXT_NODE);var r=u?s.parentNode:s;var v;var t=q?"nextSibling":"previousSibling";if(u){v=s[t];if(v&&v.nodeType==p.TEXT_NODE){return v}}else{v=r[t];if(v&&this.areElementsMergeable(s,v)){return v[q?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(r,q){return l.dom.arrayContains(this.tagNames,(r.tagName||"").toLowerCase())&&l.dom.arrayContains(this.tagNames,(q.tagName||"").toLowerCase())&&o(r,q)&&g(r,q)},createContainer:function(r){var q=r.createElement(this.tagNames[0]);if(this.cssClass){q.className=this.cssClass}return q},applyToTextNode:function(s){var r=s.parentNode;if(r.childNodes.length==1&&l.dom.arrayContains(this.tagNames,r.tagName.toLowerCase())){if(this.cssClass){k(r,this.cssClass,this.similarClassRegExp)}}else{var q=this.createContainer(l.dom.getDocument(s));s.parentNode.insertBefore(q,s);q.appendChild(s)}},isRemovable:function(q){return l.dom.arrayContains(this.tagNames,q.tagName.toLowerCase())&&p.lang.string(q.className).trim()==this.cssClass},undoToTextNode:function(t,r,s){if(!r.containsNode(s)){var q=r.cloneRange();q.selectNode(s);if(q.isPointInRange(r.endContainer,r.endOffset)&&e(r.endContainer,r.endOffset)){d(s,r.endContainer,r.endOffset);r.setEndAfter(s)}if(q.isPointInRange(r.startContainer,r.startOffset)&&e(r.startContainer,r.startOffset)){s=d(s,r.startContainer,r.startOffset)}}if(this.similarClassRegExp){n(s,this.similarClassRegExp)}if(this.isRemovable(s)){c(s)}},applyToRange:function(r){var u=r.getNodes([p.TEXT_NODE]);if(!u.length){try{var t=this.createContainer(r.endContainer.ownerDocument);r.surroundContents(t);this.selectNode(r,t);return}catch(v){}}r.splitBoundaries();u=r.getNodes([p.TEXT_NODE]);if(u.length){var w;for(var s=0,q=u.length;s<q;++s){w=u[s];if(!this.getAncestorWithClass(w)){this.applyToTextNode(w)}}r.setStart(u[0],0);w=u[u.length-1];r.setEnd(w,w.length);if(this.normalize){this.postApply(u,r)}}},undoToRange:function(r){var u=r.getNodes([p.TEXT_NODE]),x,v;if(u.length){r.splitBoundaries();u=r.getNodes([p.TEXT_NODE])}else{var w=r.endContainer.ownerDocument,t=w.createTextNode(p.INVISIBLE_SPACE);r.insertNode(t);r.selectNode(t);u=[t]}for(var s=0,q=u.length;s<q;++s){x=u[s];v=this.getAncestorWithClass(x);if(v){this.undoToTextNode(x,r,v)}}if(q==1){this.selectNode(r,u[0])}else{r.setStart(u[0],0);x=u[u.length-1];r.setEnd(x,x.length);if(this.normalize){this.postApply(u,r)}}},selectNode:function(r,u){var t=u.nodeType===p.ELEMENT_NODE,q="canHaveHTML" in u?u.canHaveHTML:true,s=t?u.innerHTML:u.data,w=(s===""||s===p.INVISIBLE_SPACE);if(w&&t&&q){try{u.innerHTML=p.INVISIBLE_SPACE}catch(v){}}r.selectNodeContents(u);if(w&&t){r.collapse(false)}else{if(w){r.setStartAfter(u);r.setEndAfter(u)}}},getTextSelectedByRange:function(u,q){var r=q.cloneRange();r.selectNodeContents(u);var s=r.intersection(q);var t=s?s.toString():"";r.detach();return t},isAppliedToRange:function(r){var u=[],t,v=r.getNodes([p.TEXT_NODE]);if(!v.length){t=this.getAncestorWithClass(r.startContainer);return t?[t]:false}for(var s=0,q=v.length,w;s<q;++s){w=this.getTextSelectedByRange(v[s],r);t=this.getAncestorWithClass(v[s]);if(w!=""&&!t){return false}else{u.push(t)}}return u},toggleRange:function(q){if(this.isAppliedToRange(q)){this.undoToRange(q)}else{this.applyToRange(q)}}};p.selection.HTMLApplier=m})(b,rangy);b.Commands=a.extend({constructor:function(c){this.editor=c;this.composer=c.composer;this.doc=this.composer.doc},support:function(c){return b.browser.supportsCommand(this.doc,c)},exec:function(i,f){var h=b.commands[i],d=b.lang.array(arguments).get(),j=h&&h.exec,c=null;this.editor.fire("beforecommand:composer");if(j){d.unshift(this.composer);c=j.apply(h,d)}else{try{c=this.doc.execCommand(i,false,f)}catch(g){}}this.editor.fire("aftercommand:composer");return c},state:function(h,c){var g=b.commands[h],d=b.lang.array(arguments).get(),i=g&&g.state;if(i){d.unshift(this.composer);return i.apply(g,d)}else{try{return this.doc.queryCommandState(h)}catch(f){return false}}}});b.commands.bold={exec:function(c,d){return b.commands.formatInline.exec(c,d,"b")},state:function(c,d){return b.commands.formatInline.state(c,d,"b")}};(function(h){var f,e="A",g=h.dom;function c(k,p){var o=p.length,l=0,j,n,m;for(;l<o;l++){j=p[l];n=g.getParentElement(j,{nodeName:"code"});m=g.getTextContent(j);if(m.match(g.autoLink.URL_REG_EXP)&&!n){n=g.renameElement(j,"code")}else{g.replaceWithChildNodes(j)}}}function d(k,o){var w=k.doc,t="_wysihtml5-temp-"+(+new Date()),y=/non-matching-class/g,s=0,m,l,r,v,q,p,u,x,n;h.commands.formatInline.exec(k,f,e,t,y);l=w.querySelectorAll(e+"."+t);m=l.length;for(;s<m;s++){r=l[s];r.removeAttribute("class");for(n in o){r.setAttribute(n,o[n])}}p=r;if(m===1){u=g.getTextContent(r);v=!!r.querySelector("*");q=u===""||u===h.INVISIBLE_SPACE;if(!v&&q){g.setTextContent(r,o.text||r.href);x=w.createTextNode(" ");k.selection.setAfter(r);g.insert(x).after(r);p=x}}k.selection.setAfter(p)}h.commands.createLink={exec:function(j,m,l){var k=this.state(j,m);if(k){j.selection.executeAndRestore(function(){c(j,k)})}else{l=typeof(l)==="object"?l:{href:l};var i=l.href;l.href=/http[s]?:\/\//.test(i)?i:"http://"+i;d(j,l)}},state:function(i,j){return h.commands.formatInline.state(i,j,"A")}}})(b);(function(d){var c=/wysiwyg-font-size-[0-9a-z\-]+/g;d.commands.fontSize={exec:function(e,g,f){return d.commands.formatInline.exec(e,g,"span","wysiwyg-font-size-"+f,c)},state:function(e,g,f){return d.commands.formatInline.state(e,g,"span","wysiwyg-font-size-"+f,c)}}})(b);(function(d){var c=/wysiwyg-color-[0-9a-z]+/g;d.commands.foreColor={exec:function(f,g,e){return d.commands.formatInline.exec(f,g,"span","wysiwyg-color-"+e,c)},state:function(f,g,e){return d.commands.formatInline.state(f,g,"span","wysiwyg-color-"+e,c)}}})(b);(function(h){var p=h.dom,r=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE","DIV"];function n(u,v,w){if(u.className){g(u,w);u.className+=" "+v}else{u.className=v}}function g(u,v){u.className=u.className.replace(v,"")}function j(u){return u.nodeType===h.TEXT_NODE&&!h.lang.string(u.data).trim()}function k(v){var u=v.previousSibling;while(u&&j(u)){u=u.previousSibling}return u}function l(u){var v=u.nextSibling;while(v&&j(v)){v=v.nextSibling}return v}function f(v){var x=v.ownerDocument,w=l(v),u=k(v);if(w&&!e(w)){v.parentNode.insertBefore(x.createElement("br"),w)}if(u&&!e(u)){v.parentNode.insertBefore(x.createElement("br"),v)}}function c(v){var w=l(v),u=k(v);if(w&&m(w)){w.parentNode.removeChild(w)}if(u&&m(u)){u.parentNode.removeChild(u)}}function o(v){var u=v.lastChild;if(u&&m(u)){u.parentNode.removeChild(u)}}function m(u){return u.nodeName==="BR"}function e(u){if(m(u)){return true}if(p.getStyle("display").from(u)==="block"){return true}return false}function d(w,x,y,v){if(v){var u=p.observe(w,"DOMNodeInserted",function(A){var B=A.target,z;if(B.nodeType!==h.ELEMENT_NODE){return}z=p.getStyle("display").from(B);if(z.substr(0,6)!=="inline"){B.className+=" "+v}})}w.execCommand(x,false,y);if(u){u.stop()}}function s(u,v){u.selection.selectLine();u.selection.surround(v);c(v);o(v);u.selection.selectNode(v,h.browser.displaysCaretInEmptyContentEditableCorrectly())}function t(u){return !!h.lang.string(u.className).trim()}function q(v){var u=v.createElement("p");u.appendChild(v.createElement("br"));return u}function i(v,w){var u;while(v&&(u=v.parentNode)&&u){if(u.nodeName==w){return u}v=u}return false}h.commands.formatBlock={exec:function(D,w,u,v,G){var K=D.doc,B=this.state(D,w,u,v,G),C=D.config.useLineBreaks,A=C?"DIV":"P",I;u=typeof(u)==="string"?u.toUpperCase():u;if(B){D.selection.executeAndRestoreSimple(function(){if(G){g(B,G)}var M=t(B);if(!M&&(C||u==="P"||u==="BLOCKQUOTE")){if(u!=="BLOCKQUOTE"){f(B)}p.replaceWithChildNodes(B)}else{p.renameElement(B,u==="P"?"DIV":A)}});return}if(u===null||h.lang.array(r).contains(u)){I=D.selection.getSelectedNode();B=p.getParentElement(I,{nodeName:r});if(B){D.selection.executeAndRestore(function(){if(u){if(u=="BLOCKQUOTE"){var M=K.createElement("blockquote");B=p.replaceAndBecomeChild(B,M)}else{B=p.renameElement(B,u)}}if(v){n(B,v,G)}});return}else{if(u=="BLOCKQUOTE"){var L=D.selection.getSelection();if(!L||L.rangeCount<=0){return}try{var E=L.getRangeAt(0)}catch(J){return}if(E.startContainer.nodeName=="BODY"||E.endContainer.nodeName=="BODY"){return}var y;if(I.nodeType==I.TEXT_NODE&&I.parentNode&&I.parentNode.nodeName==="BODY"){E.setStartBefore(I);E.setEndAfter(I)}else{if((y=i(I,"LI"))!==false){E.setStartBefore(y.parentNode);E.setEndAfter(y.parentNode)}else{if(I.nodeName=="UL"||I.nodeName=="OL"){E.setStartBefore(I);E.setEndAfter(I)}else{var z=E.startContainer.parentNode&&E.startContainer.parentNode.nodeName!=="BODY"?E.startContainer.parentNode:E.startContainer,x=E.endContainer.parentNode&&E.endContainer.parentNode.nodeName!=="BODY"?E.endContainer.parentNode:E.endContainer;E.setStartBefore(z);E.setEndAfter(x)}}}var H=p.getAsDom(E.toHtml());(function F(M){if(M&&M.length>0){p.replaceWithChildNodes(M[0]);return F(M)}})(H.getElementsByTagName("blockquote"));E.deleteContents();E.insertNode(H);p.renameElement(H,u);L.removeAllRanges();return}}}if(D.commands.support(w)){d(K,w,u||A,v);return}B=K.createElement(u||A);if(v){B.className=v}s(D,B)},state:function(u,y,z,v,x){z=typeof(z)==="string"?z.toUpperCase():z;var w=u.selection.getSelectedNode();return p.getParentElement(w,{nodeName:z,className:v,classRegExp:x})}}})(b);(function(g){var e={strong:"b",em:"i",b:"strong",i:"em"},f={};function d(i){var h=e[i];return h?[i.toLowerCase(),h.toLowerCase()]:[i.toLowerCase()]}function c(i,j,k){var h=i+":"+j;if(!f[h]){f[h]=new g.selection.HTMLApplier(d(i),j,k,true)}return f[h]}g.commands.formatInline={exec:function(i,m,j,k,l){var h=i.selection.getRange();if(!h){return false}c(j,k,l).toggleRange(h);i.selection.setSelection(h)},state:function(i,n,j,k,l){var m=i.doc,o=e[j]||j,h;if(!g.dom.hasElementWithTagName(m,j)&&!g.dom.hasElementWithTagName(m,o)){return false}if(k&&!g.dom.hasElementWithClassName(m,k)){return false}h=i.selection.getRange();if(!h){return false}return c(j,k,l).isAppliedToRange(h)}}})(b);b.commands.insertHTML={exec:function(c,e,d){if(c.commands.support(e)){c.doc.execCommand(e,false,d)}else{c.selection.insertHTML(d)}},state:function(){return false}};(function(d){var c="IMG";d.commands.insertImage={exec:function(e,j,m){m=typeof(m)==="object"?m:{src:m};var l=e.doc,h=this.state(e),g,n;if(h){e.selection.setBefore(h);n=h.parentNode;n.removeChild(h);d.dom.removeEmptyTextNodes(n);if(n.nodeName==="A"&&!n.firstChild){e.selection.setAfter(n);n.parentNode.removeChild(n)}d.quirks.redraw(e.element)}else{h=l.createElement(c);for(var k in m){h.setAttribute(k==="className"?"class":k,m[k])}h.onload=function(){e.parent.fire("imageloaded:composer")};var f=l.createElement("p");f.appendChild(h);e.selection.insertNode(f);if(d.browser.hasProblemsSettingCaretAfterImg()){g=l.createTextNode(d.INVISIBLE_SPACE);e.selection.insertNode(g);e.selection.setAfter(g)}else{e.selection.setAfter(f)}}},state:function(f){var h=f.doc,g,i,e;if(!d.dom.hasElementWithTagName(h,c)){return false}g=f.selection.getSelectedNode();if(!g){return false}if(g.nodeName===c){return g}if(g.nodeType!==d.ELEMENT_NODE){return false}i=f.selection.getText();i=d.lang.string(i).trim();if(i){return false}e=f.selection.getNodes(d.ELEMENT_NODE,function(j){return j.nodeName==="IMG"});if(e.length!==1){return false}return e[0]}}})(b);(function(d){var c="<br>"+(d.browser.needsSpaceAfterLineBreak()?" ":"");d.commands.insertLineBreak={exec:function(e,f){if(e.commands.support(f)){e.doc.execCommand(f,false,null);if(!d.browser.autoScrollsToCaret()){e.selection.scrollIntoView()}}else{e.commands.exec("insertHTML",c)}},state:function(){return false}}})(b);b.commands.insertOrderedList={exec:function(c,f){var k=c.doc,h=c.selection.getSelectedNode(),i=b.dom.getParentElement(h,{nodeName:"OL"}),j=b.dom.getParentElement(h,{nodeName:"UL"}),e="_wysihtml5-temp-"+new Date().getTime(),g,d;if(!i&&!j&&c.commands.support(f)){k.execCommand(f,false,null);return}if(i){c.selection.executeAndRestore(function(){b.dom.resolveList(i,c.config.useLineBreaks)})}else{if(j){c.selection.executeAndRestore(function(){b.dom.renameElement(j,"ol")})}else{c.commands.exec("formatBlock","div",e);d=k.querySelector("."+e);g=d.innerHTML===""||d.innerHTML===b.INVISIBLE_SPACE||d.innerHTML==="<br>";c.selection.executeAndRestore(function(){i=b.dom.convertToList(d,"ol")});if(g){c.selection.selectNode(i.querySelector("li"),true)}}}},state:function(c){var d=c.selection.getSelectedNode();return b.dom.getParentElement(d,{nodeName:"OL"})}};b.commands.insertUnorderedList={exec:function(c,f){var k=c.doc,h=c.selection.getSelectedNode(),i=b.dom.getParentElement(h,{nodeName:"UL"}),j=b.dom.getParentElement(h,{nodeName:"OL"}),e="_wysihtml5-temp-"+new Date().getTime(),g,d;if(!i&&!j&&c.commands.support(f)){k.execCommand(f,false,null);return}if(i){c.selection.executeAndRestore(function(){b.dom.resolveList(i,c.config.useLineBreaks)})}else{if(j){c.selection.executeAndRestore(function(){b.dom.renameElement(j,"ul")})}else{c.commands.exec("formatBlock","div",e);d=k.querySelector("."+e);g=d.innerHTML===""||d.innerHTML===b.INVISIBLE_SPACE||d.innerHTML==="<br>";c.selection.executeAndRestore(function(){i=b.dom.convertToList(d,"ul")});if(g){c.selection.selectNode(i.querySelector("li"),true)}}}},state:function(c){var d=c.selection.getSelectedNode();return b.dom.getParentElement(d,{nodeName:"UL"})}};b.commands.italic={exec:function(c,d){return b.commands.formatInline.exec(c,d,"i")},state:function(c,d){return b.commands.formatInline.state(c,d,"i")}};(function(e){var d="wysiwyg-text-align-center",c=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyCenter={exec:function(f,g){return e.commands.formatBlock.exec(f,"formatBlock",null,d,c)},state:function(f,g){return e.commands.formatBlock.state(f,"formatBlock",null,d,c)}}})(b);(function(e){var d="wysiwyg-text-align-left",c=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyLeft={exec:function(f,g){return e.commands.formatBlock.exec(f,"formatBlock",null,d,c)},state:function(f,g){return e.commands.formatBlock.state(f,"formatBlock",null,d,c)}}})(b);(function(e){var d="wysiwyg-text-align-right",c=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyRight={exec:function(f,g){return e.commands.formatBlock.exec(f,"formatBlock",null,d,c)},state:function(f,g){return e.commands.formatBlock.state(f,"formatBlock",null,d,c)}}})(b);(function(e){var d="wysiwyg-text-align-justify",c=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyFull={exec:function(f,g){return e.commands.formatBlock.exec(f,"formatBlock",null,d,c)},state:function(f,g){return e.commands.formatBlock.state(f,"formatBlock",null,d,c)}}})(b);b.commands.redo={exec:function(c){return c.undoManager.redo()},state:function(c){return false}};b.commands.underline={exec:function(c,d){return b.commands.formatInline.exec(c,d,"u")},state:function(c,d){return b.commands.formatInline.state(c,d,"u")}};b.commands.undo={exec:function(c){return c.undoManager.undo()},state:function(c){return false}};(function(n){var i=90,l=89,m=8,d=46,c=25,k="data-wysihtml5-selection-node",e="data-wysihtml5-selection-offset",j='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"</span>",h='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"</span>",g=n.dom;function f(p){var o;while(o=p.querySelector("._wysihtml5-temp")){o.parentNode.removeChild(o)}}n.UndoManager=n.lang.Dispatcher.extend({constructor:function(o){this.editor=o;this.composer=o.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var r=this,t=this.composer.sandbox.getDocument(),o;g.observe(this.element,"keydown",function(w){if(w.altKey||(!w.ctrlKey&&!w.metaKey)){return}var x=w.keyCode,u=x===i&&!w.shiftKey,v=(x===i&&w.shiftKey)||(x===l);if(u){r.undo();w.preventDefault()}else{if(v){r.redo();w.preventDefault()}}});g.observe(this.element,"keydown",function(u){var v=u.keyCode;if(v===o){return}o=v;if(v===m||v===d){r.transact()}});if(n.browser.hasUndoInContextMenu()){var p,q,s=function(){f(t);clearInterval(p)};g.observe(this.element,"contextmenu",function(){s();r.composer.selection.executeAndRestoreSimple(function(){if(r.element.lastChild){r.composer.selection.setAfter(r.element.lastChild)}t.execCommand("insertHTML",false,j);t.execCommand("insertHTML",false,h);t.execCommand("undo",false,null)});p=setInterval(function(){if(t.getElementById("_wysihtml5-redo")){s();r.redo()}else{if(!t.getElementById("_wysihtml5-undo")){s();r.undo()}}},400);if(!q){q=true;g.observe(document,"mousedown",s);g.observe(t,["mousedown","paste","cut","copy"],s)}})}this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var w=this.historyStr[this.position-1],q=this.composer.getValue();if(q===w){return}var o=this.historyStr.length=this.historyDom.length=this.position;if(o>c){this.historyStr.shift();this.historyDom.shift();this.position--}this.position++;var t=this.composer.selection.getRange(),p=t.startContainer||this.element,r=t.startOffset||0,s,u;if(p.nodeType===n.ELEMENT_NODE){s=p}else{s=p.parentNode;u=this.getChildNodeIndex(s,p)}s.setAttribute(e,r);if(typeof(u)!=="undefined"){s.setAttribute(k,u)}var v=this.element.cloneNode(!!q);this.historyDom.push(v);this.historyStr.push(q);s.removeAttribute(e);s.removeAttribute(k)},undo:function(){this.transact();if(!this.undoPossible()){return}this.set(this.historyDom[--this.position-1]);this.editor.fire("undo:composer")},redo:function(){if(!this.redoPossible()){return}this.set(this.historyDom[++this.position-1]);this.editor.fire("redo:composer")},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(u){this.element.innerHTML="";var p=0,t=u.childNodes,r=u.childNodes.length;for(;p<r;p++){this.element.appendChild(t[p].cloneNode(true))}var s,q,o;if(u.hasAttribute(e)){s=u.getAttribute(e);o=u.getAttribute(k);q=this.element}else{q=this.element.querySelector("["+e+"]")||this.element;s=q.getAttribute(e);o=q.getAttribute(k);q.removeAttribute(e);q.removeAttribute(k)}if(o!==null){q=this.getChildNodeByIndex(q,+o)}this.composer.selection.set(q,s)},getChildNodeIndex:function(p,s){var o=0,r=p.childNodes,q=r.length;for(;o<q;o++){if(r[o]===s){return o}}},getChildNodeByIndex:function(p,o){return p.childNodes[o]}})})(b);b.views.View=a.extend({constructor:function(d,e,c){this.parent=d;this.element=e;this.config=c;this._observeViewChange()},_observeViewChange:function(){var c=this;this.parent.on("beforeload",function(){c.parent.on("change_view",function(d){if(d===c.name){c.parent.currentView=c;c.show();setTimeout(function(){c.focus()},0)}else{c.hide()}})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")===this.element){return}try{this.element.focus()}catch(c){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(g){var f=g.dom,e=g.browser;var c=new RegExp("<img|<iframe|<video|<hr|<canvas","i");var d=new RegExp("img|iframe|video|hr|canvas|br");g.views.Composer=g.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(i,j,h){this.base(i,j,h);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=e.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(i){var h=this.isEmpty()?"":g.quirks.getCorrectInnerHTML(this.element);if(i){h=this.parent.parse(h)}return h},setValue:function(h,j){if(j){h=this.parent.parse(h)}try{this.element.innerHTML=h}catch(i){this.element.innerText=h}},show:function(){this.iframe.style.display=this._displayStyle||"";if(!this.textarea.element.disabled){this.disable();this.enable()}},hide:function(){this._displayStyle=f.getStyle("display").from(this.iframe);if(this._displayStyle==="none"){this._displayStyle=null}this.iframe.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(i){if(g.browser.doesAsyncFocus()&&this.hasPlaceholderSet()){this.clear()}this.base();var h=this.element.lastChild;if(i&&h){if(h.nodeName==="BR"){this.selection.setBefore(this.element.lastChild)}else{this.selection.setAfter(this.element.lastChild)}}},getTextContent:function(){return f.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")&&this.placeholderSet},isEmpty:function(){var h=this.element.innerHTML.toLowerCase();return h===""||h==="<br>"||h==="<p></p>"||h==="<p><br></p>"||this.hasPlaceholderSet()},_initSandbox:function(){var i=this;this.sandbox=new f.Sandbox(function(){i._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var j=this.textarea.element;f.insert(this.iframe).after(j);if(j.form){var h=document.createElement("input");h.type="hidden";h.name="_wysihtml5_mode";h.value=1;f.insert(h).after(j)}},_create:function(){var j=this;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(true);this.selection=new g.Selection(this.parent);this.commands=new g.Commands(this.parent);f.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element);f.addClass(this.element,this.config.composerClassName);if(this.config.style){this.style()}this.observe();var i=this.config.name;if(i){f.addClass(this.element,i);f.addClass(this.iframe,i)}this.enable();if(this.textarea.element.disabled){this.disable()}var h=typeof(this.config.placeholder)==="string"?this.config.placeholder:this.textarea.element.getAttribute("placeholder");if(h){f.simulatePlaceholder(this.parent,this,h)}this.commands.exec("styleWithCSS",false);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();this._initLineBreaking();if(j.config.titleMode){this._initAutoFormatting()}if(j.config.autoCheckCase){this._initCheckCase()}this.repositionCaretAt=function(k){if(!e.displaysCaretInEmptyContentEditableCorrectly()){if(k.innerHTML==""){k.innerHTML=="<br>"}j.selection.setBefore(k.firstChild)}else{j.selection.selectNode(k,true)}return k};this.repositionCaretAtEndOf=function(l){l.focus();var k=j.selection.getRange().cloneRange();k.selectNodeContents(l);k.collapse(false);var m=j.selection.getSelection();m.removeAllRanges();m.addRange(k)};this.insertNodes=function(l,k){if(k.length<=0){return l}l.parentNode.insertBefore(k[0],l.nextSibling);return j.insertNodes(k[0],k.slice(1,k.length))};this.makeEmptyParagraph=function(){var k=j.doc.createElement("p");k.appendChild(j.doc.createElement("br"));return k};this.replaceNodeWith=function(l,k){var m=j.insertNodes(l,k);l.parentNode.removeChild(l);return m};this.nodeIsEmpty=function(m){switch(m.nodeType){case g.DOC_FRAGMENT_NODE:var l=true;for(var k=0;k<m.childNodes.length;k++){l=l&&_nodeIsEmpty(m.childNodes[k])}return l;case g.ELEMENT_NODE:var o=m.innerHTML;var n=g.dom.getTextContent(m);return(!d.test(m.nodeName.toLowerCase()))&&(n.replace(/\s/g,"").length==0)&&(o!==undefined&&!c.test(o));case g.TEXT_NODE:return m.wholeText.replace(/\s/g,"").length==0}};if((this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&!e.isIos()){setTimeout(function(){j.focus(true)},100)}if(!e.clearsContentEditableCorrectly()){g.quirks.ensureProperClearing(this)}if(this.initSync&&this.config.sync){this.initSync()}this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var l=this,i=e.canDisableAutoLinking(),j=e.doesAutoLinkingInContentEditable();if(i){this.commands.exec("autoUrlDetect",false)}if(!this.config.autoLink){return}function n(){if(f.getTextContent(l.element).match(f.autoLink.URL_REG_EXP)){l.selection.executeAndRestore(function(o,p){f.autoLink(p.parentNode);l.doResize()})}}if(!j||(j&&i)){this.parent.on("newword:composer",n);this.parent.on("paste:composer",n);this.parent.on("enable:composer",n);this.parent.on("beforeload",n);this.parent.on("load",n);f.observe(this.element,["blur","focus","load","beforeload"],function(){f.autoLink(l.element);l.doResize()})}var h=this.sandbox.getDocument().getElementsByTagName("a"),m=f.autoLink.URL_REG_EXP,k=function(o){var p=g.lang.string(f.getTextContent(o)).trim();if(p.substr(0,4)==="www."){p="http://"+p}return p};f.observe(this.element,"keydown",function(q){if(!h.length){return}var r=l.selection.getSelectedNode(q.target.ownerDocument),p=f.getParentElement(r,{nodeName:"A"},4),o;if(!p){return}o=k(p);setTimeout(function(){var s=k(p);if(s===o){return}if(s.match(m)){p.setAttribute("href",s)}},0)})},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",true);if(e.supportsEvent("resizeend")){var j=["width","height"],i=j.length,h=this.element;f.observe(h,"resizeend",function(m){var o=m.target||m.srcElement,l=o.style,k=0,n;if(o.nodeName!=="IMG"){return}for(;k<i;k++){n=j[k];if(l[n]){o.setAttribute(n,parseInt(l[n],10));l[n]=""}}g.quirks.redraw(h)})}},_initUndoManager:function(){this.undoManager=new g.UndoManager(this.parent)},_initLineBreaking:function(){var l=this,i=["LI","P","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"],h=["UL","OL","MENU"];function o(r){var q=f.getParentElement(r,{nodeName:["P","DIV"]},2);if(q){l.selection.executeAndRestore(function(){if(l.config.useLineBreaks){f.replaceWithChildNodes(q)}else{if(q.nodeName!=="P"){f.renameElement(q,"p")}}})}}var p=(function(){if(l.config.autoInsertHR){return function(s){var t=s.nextElementSibling||false,r=s.previousElementSibling||false,q=s.parentNode||false;if(q){switch(q.nodeName){case"BLOCKQUOTE":return false;case"DIV":f.replaceWithChildNodes(q);break}}if(l.nodeIsEmpty(s)&&(t&&t.nodeName=="HR"||r&&r.nodeName=="HR")){return false}else{if(r&&l.nodeIsEmpty(r)&&r.nodeName!=="HR"){if(!r.previousElementSibling||r.previousElementSibling.nodeName!=="HR"){return r}else{return false}}else{if(t&&l.nodeIsEmpty(t)&&t.nodeName!=="HR"){if(!t.nextElementSibling||t.nextElementSibling.nodeName!=="HR"){return t}else{return false}}else{if(!l.nodeIsEmpty(s)){return false}}}}return s}}else{return function(q){return false}}})();function k(r,q){q=q||"next";var s=(q==="next")?r.nextElementSibling:r.previousElementSibling;if(s&&s.nodeName==="P"&&m(s.innerHTML)===""){s.remove()}}function m(r,q,t){t=t||"";var s=new RegExp("<"+(q||"")+"[^>]*>","g");return r.replace(s,t)}function n(s,q,r){if(s.nodeName==="P"){s.innerHTML=m(s.innerHTML,q,r)}}function j(v,s){var u=s.keyCode;if(g.browser.detectsReturnKeydownAfterItIsDone()&&u==g.ENTER_KEY&&!s.shiftKey){v=v.previousElementSibling||v}if(!l.nodeIsEmpty(v)&&u===g.ENTER_KEY){v.innerHTML=f.parse(v,l.config.parserRules).innerHTML}if(!g.browser.hasIframeFocusIssue()&&g.browser.detectsReturnKeydownAfterItIsDone()){var q=v.nextElementSibling,r=function(w){n(w,"br","<br>")};if(u===g.ENTER_KEY&&v.nodeName.match(/^H[1-6]$/)){var t=l.selection.getSelectedNode().previousElementSibling;t.innerHTML=f.parse(t,l.config.parserRules).innerHTML}if(u===g.ENTER_KEY){r(v);if(q){r(q)}}else{if(u===g.BACKSPACE_KEY&&q&&m(q.innerHTML)===""){r(q)}}}}if(!this.config.useLineBreaks){f.observe(this.element,["focus","keydown"],function(){if(l.isEmpty()){var q=l.doc.createElement("P");l.element.innerHTML="";l.element.appendChild(q);if(!e.displaysCaretInEmptyContentEditableCorrectly()){q.innerHTML="<br>";l.selection.setBefore(q.firstChild)}else{l.selection.selectNode(q,true)}}})}if(e.createsNestedInvalidMarkupAfterPaste()){f.observe(this.element,"paste",function(r){var q=l.doc.createTextNode(g.INVISIBLE_SPACE);l.selection.insertNode(q)})}if(e.detectsReturnKeydownAfterItIsDone()){f.observe(this.doc,"keyup",function(q){var r=q.keyCode,s=l.selection.getSelectedNode();if(s.nodeType===g.TEXT_NODE&&s.textContent.slice(-2).slice(0,-1)===" "&&!q.shiftKey&&r!==g.ENTER_KEY&&r!==g.BACKSPACE_KEY){s.parentNode.innerHTML=m(s.parentNode.innerHTML,"br");l.repositionCaretAtEndOf(l.selection.getSelectedNode())}})}f.observe(this.doc,"keydown",function(r){var D=r.keyCode;if(e.detectsReturnKeydownAfterItIsDone()){var B=l.selection.getSelectedNode();if(D!==g.ENTER_KEY&&B.nodeName==="P"){var C=m(B.innerHTML,"br");if(C===""){B.innerHTML=C}}}if(l.config.titleMode&&D===g.ENTER_KEY){r.preventDefault();return}if(D!==g.ENTER_KEY&&r.shiftKey){return}if(D!==g.ENTER_KEY&&D!==g.BACKSPACE_KEY){return}var u=function(F,E){setTimeout(function(){k(F,E)},0)};var y=f.getParentElement(l.selection.getSelectedNode(),{nodeName:i},4);if(y){if(r.shiftKey&&r.keyCode==g.ENTER_KEY){r.preventDefault();l.repositionCaretAt(l.insertNodes(y,[l.makeEmptyParagraph()]))}if(e.detectsReturnKeydownAfterItIsDone()){var s=["HR","IFRAME"];var z=function(E){setTimeout(function(){E=E.previousElementSibling;if(rangy.dom.arrayContains(s,E.nodeName)){E.remove()}})};if(r.keyCode===g.BACKSPACE_KEY&&l.isEmpty()){r.preventDefault()}else{if(r.keyCode===g.BACKSPACE_KEY){var q=y.previousElementSibling,A=(q&&q.previousElementSibling)?q.previousElementSibling.childNodes:[],w=rangy.dom.arrayContains;if(y&&q&&m(y.innerHTML)===""&&w(s,q.nodeName)){if(q.previousElementSibling&&A.length&&A[0].nodeName==="IFRAME"){q.outerHTML=l.makeEmptyParagraph().outerHTML}else{q.remove()}}if(w(h,y.parentNode.nodeName)&&y.parentNode.childNodes.length===1&&m(y.innerHTML)===""&&w(s,y.parentNode.previousElementSibling.nodeName)){y.parentNode.previousElementSibling.remove()}if(y&&q&&q.childNodes.length&&m(y.innerHTML)===""&&w(s,q.childNodes[0].nodeName)){z(q);q.remove()}if(y&&y.nodeName==="P"&&y.childNodes.length&&y.childNodes[0].nodeName==="IFRAME"){y.childNodes[0].remove()}}}}if(e.insertsLineBreaksOnReturn()&&!e.detectsReturnKeydownAfterItIsDone()){j(y,r)}setTimeout(function(){var F=l.selection.getSelectedNode(),E;if(y.nodeName==="LI"){if(!F){return}E=f.getParentElement(F,{nodeName:h},2);if(!E){o(F)}}if(!e.hasIframeFocusIssue()){j(y,r)}if(D===g.ENTER_KEY&&y.nodeName.match(/^H[1-6]$/)){o(F)}},0);return}else{if(e.detectsReturnKeydownAfterItIsDone()&&D!==g.BACKSPACE_KEY){var v=l.selection.getSelectedNode();v.innerHTML=g.dom.parse(v,l.config.parserRules).innerHTML;if(D===g.ENTER_KEY){l.repositionCaretAt(v.appendChild(l.makeEmptyParagraph()))}else{var t=v.childNodes,x=l._isSiblingOfA(t[t.length-1],"P");if(x){l.repositionCaretAtEndOf(x)}}}}if(l.config.useLineBreaks&&D===g.ENTER_KEY&&!g.browser.insertsLineBreaksOnReturn()){l.commands.exec("insertLineBreak");r.preventDefault()}})},_initAutoFormatting:function(){var i=this,h=["LI","P","H1","H2","H3","H4","H5","H6"];f.observe(this.element,["blur"],function(){var j=f.getParentElement(i.selection.getSelectedNode(),{nodeName:h},4);if(j){j.innerHTML=j.innerHTML.replace(/^(&nbsp;)+|(&nbsp;)+$/g,"").replace(/^\s*[a-zçáàéèíìóòúùñãõüïâêîôû]/,function(k){return k.toUpperCase()})}})},_initCheckCase:function(){var h=this;f.observe(this.element,["keydown","blur"],function(n){if(n.type=="blur"||n.keyCode==g.ENTER_KEY){var p=f.getTextContent(h.element);var k=p.match(/[A-ZÇÁÀÉÈÍÌÓÒÚÙÑÃÕÜÏÂÊÎÔÛ]/g);var j=k?k.length:0;var o=j/p.length;var m=h.config.alertUpperRatio;for(var l=0;l<m.length;l++){if(o>m[l]){h.parent.fire("alertUpper:composer",{ratio:m[l]});return}}h.parent.fire("alertUpperSafe:composer")}})}})})(b);(function(k){var c=k.dom,g=document,e=window,f=g.createElement("div"),d=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],i=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",k.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"];var j=function(n){if(n.setActive){try{n.setActive()}catch(p){}}else{var o=n.style,q=g.documentElement.scrollTop||g.body.scrollTop,m=g.documentElement.scrollLeft||g.body.scrollLeft,l={position:o.position,top:o.top,left:o.left,WebkitUserSelect:o.WebkitUserSelect};c.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(n);n.focus();c.setStyles(l).on(n);if(e.scrollTo){e.scrollTo(m,q)}}};k.views.Composer.prototype.style=function(){var o=this,n=g.querySelector(":focus"),p=this.textarea.element,s=p.hasAttribute("placeholder"),l=s&&p.getAttribute("placeholder"),q=p.style.display,m=p.disabled,r;if(this.parent.config.autoResize){h[0]="html                 { height: 100%; clear:both; overflow:hidden; }";h[1]="body                 { overflow:auto; clear: both; padding: 1px 0 0 0; margin: -1px 0 0 0; }"}this.focusStylesHost=f.cloneNode(false);this.blurStylesHost=f.cloneNode(false);this.disabledStylesHost=f.cloneNode(false);if(s){p.removeAttribute("placeholder")}if(p===n){p.blur()}p.disabled=false;p.style.display=r="none";if((p.getAttribute("rows")&&c.getStyle("height").from(p)==="auto")||(p.getAttribute("cols")&&c.getStyle("width").from(p)==="auto")){p.style.display=r=q}c.copyStyles(i).from(p).to(this.iframe).andTo(this.blurStylesHost);c.copyStyles(d).from(p).to(this.element).andTo(this.blurStylesHost);c.insertCSS(h).into(this.element.ownerDocument);p.disabled=true;c.copyStyles(i).from(p).to(this.disabledStylesHost);c.copyStyles(d).from(p).to(this.disabledStylesHost);p.disabled=m;p.style.display=q;j(p);p.style.display=r;c.copyStyles(i).from(p).to(this.focusStylesHost);c.copyStyles(d).from(p).to(this.focusStylesHost);p.style.display=q;c.copyStyles(["display"]).from(p).to(this.iframe);var t=k.lang.array(i).without(["display"]);if(n){n.focus()}else{p.blur()}if(s){p.setAttribute("placeholder",l)}if(!this.parent.config.autoResize){this.parent.on("focus:composer",function(){c.copyStyles(t).from(o.focusStylesHost).to(o.iframe);c.copyStyles(d).from(o.focusStylesHost).to(o.element)});this.parent.on("blur:composer",function(){c.copyStyles(t).from(o.blurStylesHost).to(o.iframe);c.copyStyles(d).from(o.blurStylesHost).to(o.element)});this.parent.observe("disable:composer",function(){c.copyStyles(t).from(o.disabledStylesHost).to(o.iframe);c.copyStyles(d).from(o.disabledStylesHost).to(o.element)});this.parent.observe("enable:composer",function(){c.copyStyles(t).from(o.blurStylesHost).to(o.iframe);c.copyStyles(d).from(o.blurStylesHost).to(o.element)})}return this}})(b);(function(f){var e=f.dom,d=f.browser;var c={};f.views.Composer.prototype.observe=function(){var o=this,h=this.getValue(),k=this.sandbox.getIframe(),l=this.element,t=d.supportsEventsInIframeCorrectly()?l:this.sandbox.getWindow(),j=["drop","paste"];var q=this.config.shortcuts;q.bold!==false?c[q.bold.charCodeAt(0)]="bold":false;q.italic!==false?c[q.italic.charCodeAt(0)]="italic":false;q.underline!==false?c[q.underline.charCodeAt(0)]="underline":false;this.minIframeHeight=parseInt(k.style.height.replace("px",""),10);this._getCaretOffset=(function(u){var w=u.ownerDocument||u.document;var v=w.defaultView||w.parentWindow;return function(){var C,A,z,x=0;if(typeof v.getSelection!="undefined"){C=v.getSelection();if(C.rangeCount){A=C.getRangeAt(0);z=A.cloneRange();z.selectNodeContents(u);z.setEnd(A.endContainer,A.endOffset);var y=z.toString().replace(/\n{2,}/g,"");x=y.length;var B=y.match(/\n/g);if(B!==null){x-=B.length}}}else{if((C=w.selection)&&C.type!="Control"){A=w.selection.createRange();z=w.body.createTextRange();z.moveToElementText(l);z.setEndPoint("EndToEnd",textRange);x=preCaretTextRange.text.length+y}}return x}})(l);this._getTextAroundCaret=function(v,y,z){var x=e.getTextContent(o.element).replace(/\n|^\b/g,"");var u=String.fromCharCode(v);var w=o._getCaretOffset();var A=x.substring(w-y,w+z);return A.slice(0,y)+u+A.slice(y,A.length-1)};this._applyDenyRules=function(w,u,v){if(w.length<=0){return false}else{if(u.match(w[0].rule)){v.preventDefault();o.parent.fire("deny:composer",{rule:w[0],text:u});return true}else{return this._applyDenyRules(w.slice(1,w.length),u,v)}}};this._applyFixRules=function(y,u,v,x){if(y.length<=0){return false}else{if(y[0].rule.test(u)){x.preventDefault();var w=y[0].fix(v);o.commands.exec("insertHTML",w);o.parent.fire("fix:composer",{rule:y[0],text:v,fixed:y[0].fix(v)});return}else{return this._applyFixRules(y.slice(1,y.length),u,v,x)}}};this._isChildOfA=function(w,v){var u=w.parentNode;while(u){if(u.nodeName==v){return u}else{u=u.parentNode}}return false};this._isSiblingOfA=function(u,w){if(!u){return}var v=u.previousElementSibling;while(v){if(v.nodeName===w){return v}else{v=v.previousElementSibling}}return false};e.observe(l,"keypress",function(u){var v=o.selection.getSelectedNode(true);var w=u.keyCode;if(v&&v.nodeName==="BODY"){if(o.selection.getText()===""){u.preventDefault()}}else{if(v&&v.nodeName==="P"&&(w!==f.BACKSPACE_KEY&&w!==f.DELETE_KEY&&w!==f.ENTER_KEY)&&v.firstChild&&v.firstChild.nodeName==="IMG"){u.preventDefault()}}});if(o.config.autoResize){this.doResize=function(){var u=parseInt(k.style.height.replace("px",""),10);var v=Math.min(l.offsetHeight,l.scrollHeight,l.clientHeight)+o.config.autoResizeMargin;if(v>=u){k.style.height=v+"px"}else{if(v>o.minIframeHeight){k.style.height=(u-(u-v))+"px"}else{if(u>o.minIframeHeight&&v<o.minIframeHeight){k.style.height=o.minIframeHeight+"px"}}}};var n=function(){var u=l.querySelectorAll("img, iframe");for(var v in u){u[v].onload=o.doResize;if(u[v].complete&&u[v].naturalWidth!==0){o.doResize()}}o.doResize()};this.doResize();e.observe(l,["imageloaded:composer","change:composer","keyup","keydown","paste","change"],o.doResize);o.parent.on("disable:composer",o.doResize);o.parent.on("enable:composer",o.doResize);o.parent.on("beforeload",o.doResize);o.parent.on("load",n);o.parent.on("focus",n);o.parent.on("blur",n);o.parent.on("aftercommand:composer",n);o.parent.on("change:composer",o.doResize);o.parent.on("newword:composer",o.doResize);o.parent.on("change",o.doResize)}else{this.doResize=function(){}}e.observe(k,"DOMNodeRemoved",function(){clearInterval(m);o.parent.fire("destroy:composer")});var m=setInterval(function(){if(!e.contains(document.documentElement,k)){clearInterval(m);o.parent.fire("destroy:composer")}},250);e.observe(t,"focus",function(){o.parent.fire("focus").fire("focus:composer");setTimeout(function(){h=o.getValue()},0)});e.observe(t,"blur",function(){if(h!==o.getValue()){o.parent.fire("change").fire("change:composer")}o.parent.fire("blur").fire("blur:composer")});e.observe(l,"dragenter",function(){o.parent.fire("unset_placeholder")});if(typeof o.config.filterOnPaste==="function"){o.filterOnPaste=function(v){if(v.clipboardData){v.preventDefault();var u=v.clipboardData.getData("text/html")||v.clipboardData.getData("text");u=o.config.filterOnPaste(u);if(f.browser.detectsReturnKeydownAfterItIsDone()&&!v.clipboardData.types.contains("text/html")){u=u.replace(/\n+|\r+/g,"<br><br>")}u=u.replace(/p>(&nbsp;| )/g,"p>").replace(/(&nbsp;| )<p/g,"<p").replace(/[&nbsp;$| $]*(<br[^>]*>)(<br[^>]*>)+/g,"</p><p>");o.commands.exec("insertHTML",u)}}}else{o.filterOnPaste=function(){}}e.observe(l,j,function(u){o.filterOnPaste(u);setTimeout(function(){o.parent.fire("paste").fire("paste:composer")},0)});e.observe(l,"keyup",function(u){var v=u.keyCode;if(v===f.SPACE_KEY||v===f.ENTER_KEY){o.parent.fire("newword:composer")}o.parent.fire("change:composer")});this.parent.on("paste:composer",function(){setTimeout(function(){o.parent.fire("newword:composer")},0)});if(!d.canSelectImagesInContentEditable()){e.observe(l,"mousedown",function(u){var v=u.target;if(v.nodeName==="IMG"){o.selection.selectNode(v);u.preventDefault()}})}if(d.hasHistoryIssue()&&d.supportsSelectionModify()){e.observe(l,"keydown",function(v){if(!v.metaKey&&!v.ctrlKey){return}var x=v.keyCode,w=l.ownerDocument.defaultView,u=w.getSelection();if(x===37||x===39){if(x===37){u.modify("extend","left","lineboundary");if(!v.shiftKey){u.collapseToStart()}}if(x===39){u.modify("extend","right","lineboundary");if(!v.shiftKey){u.collapseToEnd()}}v.preventDefault()}})}e.observe(l,"keydown",function(u){var v=u.keyCode,w=c[v];if((u.ctrlKey||u.metaKey)&&!u.altKey&&w){o.commands.exec(w);u.preventDefault()}});var i=function(u){return u.firstChild&&u.firstChild.nodeName==="IMG"};e.observe(l,"keydown",function(v){var x=o.selection.getSelectedNode(true),w=v.keyCode,u;if(x&&x.nodeName==="IMG"&&(w===f.BACKSPACE_KEY||w===f.DELETE_KEY)){u=x.parentNode;u.removeChild(x);if(u.nodeName==="A"&&!u.firstChild){u.parentNode.removeChild(u)}setTimeout(function(){f.quirks.redraw(l)},0);v.preventDefault()}else{x=x.nodeName=="P"?x:o._isChildOfA(x,"P");if((w==f.BACKSPACE_KEY&&i(x)&&o.selection.getSelection().anchorOffset==0)||(w==f.DELETE_KEY&&i(x)&&o.selection.getSelection().anchorOffset!=0)||(w==f.BACKSPACE_KEY&&x.previousSibling&&i(x.previousSibling)&&o.selection.getSelection().anchorOffset==0)||(w==f.DELETE_KEY&&x.nextSibling&&i(x.nextSibling)&&o.selection.getSelection().anchorOffset==x.innerText.length)){v.preventDefault()}}});var s=function(w,D,y){if(D.previousSibling&&D.previousSibling.nodeName=="BLOCKQUOTE"&&D.nextSibling&&D.nextSibling.nodeName=="BLOCKQUOTE"){w.preventDefault();var H=o.doc.createDocumentFragment(),z=D.previousSibling,B=D.nextSibling,F=z.cloneNode(true),G=B.cloneNode(true),A=F.firstChild,E=F.lastChild,C=G.firstChild,v=G.lastChild,u=o.doc.createElement("blockquote"),x=f.dom.replaceWithChildNodes;H.appendChild(u);u.appendChild(F);u.appendChild(G);x(F);x(G);D.appendChild(H);x(D);z.parentNode.removeChild(z);B.parentNode.removeChild(B);y(u,[A,E],[C,v])}};this.joinBlockquotes=s;var p=function(u,w,v){o.parent.composer.repositionCaretAtEndOf(w[1])};var r=function(u,w,v){o.parent.composer.repositionCaretAt(v[0])};e.observe(l,"keydown",function(x){var z=o.selection.getSelectedNode(true),y=x.keyCode,v;if(y===f.BACKSPACE_KEY&&o.selection.getSelection().anchorOffset==0){v=o._isChildOfA(z,"BLOCKQUOTE");if(v){var w=v.previousSibling;if(w&&w.nodeName=="P"&&o.parent.composer.nodeIsEmpty(w)){s(x,w,p)}}else{if(o.parent.composer.nodeIsEmpty(z)){s(x,z,p)}}}else{if(y==f.DELETE_KEY){v=o._isChildOfA(z,"BLOCKQUOTE");if(v){var u=v.nextSibling;if(u&&u.nodeName=="P"&&o.parent.composer.nodeIsEmpty(u)){s(x,u,r)}}else{if(o.parent.composer.nodeIsEmpty(z)){s(x,z,r)}}}}});if(d.hasIframeFocusIssue()){e.observe(this.iframe,"focus",function(){setTimeout(function(){if(o.doc.querySelector(":focus")!==o.element){o.focus()}},0)});e.observe(this.element,"blur",function(){setTimeout(function(){o.selection.getSelection().removeAllRanges()},0)})}var g={IMG:"Image: ",A:"Link: "};e.observe(l,"mouseover",function(v){var w=v.target,y=w.nodeName,x;if(y!=="A"&&y!=="IMG"){return}var u=w.hasAttribute("title");if(!u){x=g[y]+(w.getAttribute("href")||w.getAttribute("src"));w.setAttribute("title",x)}})}})(b);(function(d){var c=400;d.views.Synchronizer=a.extend({constructor:function(g,e,f){this.editor=g;this.textarea=e;this.composer=f;this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(d.lang.string(this.composer.getValue()).trim(),e)},fromTextareaToComposer:function(f){var e=this.textarea.getValue();if(e){this.composer.setValue(e,f)}else{this.composer.clear();this.editor.fire("set_placeholder")}},sync:function(e){if(this.editor.currentView.name==="textarea"){this.fromTextareaToComposer(e)}else{this.fromComposerToTextarea(e)}},_observe:function(){var e,g=this,f=this.textarea.element.form,i=function(){e=setInterval(function(){g.fromComposerToTextarea()},c)},h=function(){clearInterval(e);e=null};i();if(f){d.dom.observe(f,"submit",function(){if(!d.browser.detectsReturnKeydownAfterItIsDone()){g.sync(true)}});d.dom.observe(f,"reset",function(){setTimeout(function(){g.fromTextareaToComposer()},0)})}this.editor.on("change_view",function(j){if(j==="composer"&&!e){g.fromTextareaToComposer(true);i()}else{if(j==="textarea"){g.fromComposerToTextarea(true);h()}}});this.editor.on("destroy:composer",h)}})})(b);b.views.Textarea=b.views.View.extend({name:"textarea",constructor:function(d,e,c){this.base(d,e,c);this._observe()},clear:function(){this.element.value=""},getValue:function(j){var f=this.isEmpty()?"":this.element.value;if(j){f=this.parent.parse(f)}var g=f.match(/<iframe .*?>.*?(?=<\/iframe *>)/g);if(g&&g.length>0){for(var d in g){var h=g[d].match(/src=".*?"/)[0].replace("src","href"),e=g[d].match(/width=".*?"/)[0],c=g[d].match(/height=".*?"/)[0];f=f.replace(g[d],'<a data-media="embed-video"'+h+" "+e+" "+c+">"+h.replace(/href\=\"|\"$/g,""))}f=f.replace(/\/iframe>/g,"/a>")}f=f.replace("&nbsp;"," ").replace(/<p[^>]*?>(<br\/?>| +)?<\/p>/gi,"").replace(/(^<hr[^>]*?>)|(<hr[^>]*?>$)/gi,"");return f},setValue:function(c,d){if(d){c=this.parent.parse(c)}this.element.value=c},hasPlaceholderSet:function(){var f=b.browser.supportsPlaceholderAttributeOn(this.element),c=this.element.getAttribute("placeholder")||null,d=this.element.value,e=!d;return(f&&e)||(d===c)},isEmpty:function(){return !b.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,f=this.parent,c={focusin:"focus",focusout:"blur"},d=b.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];f.on("beforeload",function(){b.dom.observe(e,d,function(h){var g=c[h.type]||h.type;f.fire(g).fire(g+":textarea")});b.dom.observe(e,["paste","drop"],function(){setTimeout(function(){f.fire("paste").fire("paste:textarea")},0)})})}});(function(h){var g=h.dom,c="wysihtml5-command-dialog-opened",f="input, select, textarea",d="[data-wysihtml5-dialog-field]",e="data-wysihtml5-dialog-field";h.toolbar.Dialog=h.lang.Dispatcher.extend({constructor:function(j,i){this.link=j;this.container=i},_observe:function(){if(this._observed){return}var m=this,n=function(p){var i=m._serialize();if(i==m.elementToChange){m.fire("edit",i)}else{m.fire("save",i)}m.hide()};g.observe(m.link,"click",function(){if(g.hasClass(m.link,c)){setTimeout(function(){m.hide()},0)}});g.observe(this.container,"keydown",function(i){var p=i.keyCode;if(p===h.ENTER_KEY){n(i)}if(p===h.ESCAPE_KEY){m.fire("cancel");m.hide()}});g.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",n);g.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(i){m.fire("cancel");m.hide()});var k=this.container.querySelectorAll(f),j=0,l=k.length,o=function(){clearInterval(m.interval)};for(;j<l;j++){g.observe(k[j],"change",o)}this._observed=true},_serialize:function(){var m=this.elementToChange||{},j=this.container.querySelectorAll(d),l=j.length,k=0;for(;k<l;k++){m[j[k].getAttribute(e)]=j[k].value}return m},_interpolate:function(o){var n,q,m,p=document.querySelector(":focus"),j=this.container.querySelectorAll(d),l=j.length,k=0;for(;k<l;k++){n=j[k];if(n===p){continue}if(o&&n.type==="hidden"){continue}q=n.getAttribute(e);m=this.elementToChange?(this.elementToChange[q]||""):n.defaultValue;n.value=m}},show:function(l){if(g.hasClass(this.link,c)){return}var j=this,i=this.container.querySelector(f);this.elementToChange=l;this._observe();this._interpolate();if(l){this.interval=setInterval(function(){j._interpolate(true)},500)}g.addClass(this.link,c);this.container.style.display="";this.fire("show");if(i&&!l){try{i.focus()}catch(k){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;g.removeClass(this.link,c);this.container.style.display="none";this.fire("hide")}})})(b);(function(h){var g=h.dom;var f={position:"relative"};var e={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1};var d={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"};var c={"x-webkit-speech":"",speech:""};h.toolbar.Speech=function(k,l){var j=document.createElement("input");if(!h.browser.supportsSpeechApiOn(j)){l.style.display="none";return}var m=k.editor.textarea.element.getAttribute("lang");if(m){c.lang=m}var n=document.createElement("div");h.lang.object(e).merge({width:l.offsetWidth+"px",height:l.offsetHeight+"px"});g.insert(j).into(n);g.insert(n).into(l);g.setStyles(d).on(j);g.setAttributes(c).on(j);g.setStyles(e).on(n);g.setStyles(f).on(l);var i="onwebkitspeechchange" in j?"webkitspeechchange":"speechchange";g.observe(j,i,function(){k.execCommand("insertText",j.value);j.value=""});g.observe(j,"click",function(o){if(g.hasClass(l,"wysihtml5-command-disabled")){o.preventDefault()}o.stopPropagation()})}})(b);(function(h){var c="wysihtml5-command-disabled",d="wysihtml5-commands-disabled",e="wysihtml5-command-active",f="wysihtml5-action-active",g=h.dom;h.toolbar.Toolbar=a.extend({constructor:function(m,j){this.editor=m;this.container=typeof(j)==="string"?document.getElementById(j):j;this.composer=m.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();var k=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),n=k.length,l=0;for(;l<n;l++){new h.toolbar.Speech(this,k[l])}},_getLinks:function(o){var s=this[o+"Links"]=h.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+o+"]")).get(),l=s.length,m=0,j=this[o+"Mapping"]={},p,r,k,q,n;for(;m<l;m++){p=s[m];k=p.getAttribute("data-wysihtml5-"+o);q=p.getAttribute("data-wysihtml5-"+o+"-value");r=this.container.querySelector("[data-wysihtml5-"+o+"-group='"+k+"']");n=this._getDialog(p,k);j[k+":"+q]={link:p,group:r,name:k,value:q,dialog:n,state:false}}},_getDialog:function(m,n){var l=this,k=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']"),j,i;if(k){j=new h.toolbar.Dialog(m,k);j.on("show",function(){i=l.composer.selection.getBookmark();l.editor.fire("show:dialog",{command:n,dialogContainer:k,commandLink:m})});j.on("edit",function(o){l.editor.fire("edit:dialog",{command:n,dialogContainer:k,commandLink:m})});j.on("save",function(o){if(i){l.composer.selection.setBookmark(i)}l._execCommand(n,o);l.editor.fire("save:dialog",{command:n,dialogContainer:k,commandLink:m})});j.on("cancel",function(){l.editor.focus(false);l.editor.fire("cancel:dialog",{command:n,dialogContainer:k,commandLink:m})})}return j},execCommand:function(k,i){if(this.commandsDisabled){return}var j=this.commandMapping[k+":"+i];if(j&&j.dialog&&!j.state){j.dialog.show()}else{this._execCommand(k,i)}},_execCommand:function(j,i){this.editor.focus(false);this.composer.commands.exec(j,i);this._updateLinkStates()},execAction:function(j){var i=this.editor;if(j==="change_view"){if(i.currentView===i.textarea){i.fire("change_view","composer")}else{i.fire("change_view","textarea")}}},_observe:function(){var o=this,m=this.editor,j=this.container,k=this.commandLinks.concat(this.actionLinks),n=k.length,l=0;for(;l<n;l++){if(k[l].nodeName==="A"){g.setAttributes({href:"javascript:;",unselectable:"on"}).on(k[l])}else{g.setAttributes({unselectable:"on"}).on(k[l])}}g.delegate(j,"[data-wysihtml5-command]","click",function(q){var p=this,r=p.getAttribute("data-wysihtml5-command"),i=p.getAttribute("data-wysihtml5-command-value");o.execCommand(r,i)});g.delegate(j,"[data-wysihtml5-action]","click",function(i){var p=this.getAttribute("data-wysihtml5-action");o.execAction(p)});m.on("focus:composer",function(){o.bookmark=null;clearInterval(o.interval);o.interval=setInterval(function(){o._updateLinkStates()},500)});m.on("blur:composer",function(){clearInterval(o.interval)});m.on("destroy:composer",function(){clearInterval(o.interval)});m.on("change_view",function(i){setTimeout(function(){o.commandsDisabled=(i!=="composer");o._updateLinkStates();if(o.commandsDisabled){g.addClass(j,d)}else{g.removeClass(j,d)}},0)})},_updateLinkStates:function(){var k=this.commandMapping,n=this.actionMapping,j,m,l,o;for(j in k){o=k[j];if(this.commandsDisabled){m=false;g.removeClass(o.link,e);if(o.group){g.removeClass(o.group,e)}if(o.dialog){o.dialog.hide()}}else{m=this.composer.commands.state(o.name,o.value);if(h.lang.object(m).isArray()){m=m.length===1?m[0]:true}g.removeClass(o.link,c);if(o.group){g.removeClass(o.group,c)}}if(o.state===m){continue}o.state=m;if(m){g.addClass(o.link,e);if(o.group){g.addClass(o.group,e)}if(o.dialog){if(typeof(m)==="object"){o.dialog.show(m)}else{o.dialog.hide()}}}else{g.removeClass(o.link,e);if(o.group){g.removeClass(o.group,e)}if(o.dialog){o.dialog.hide()}}}for(j in n){l=n[j];if(l.name==="change_view"){l.state=this.editor.currentView===this.editor.textarea;if(l.state){g.addClass(l.link,f)}else{g.removeClass(l.link,f)}}}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(b);(function(e){var d;var c={name:d,style:true,toolbar:d,autoLink:true,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{},deny:[],fix:[],parser:[]},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:true,stylesheets:[],placeholderText:d,supportTouchDevices:true,cleanUp:true,autoInsertHR:true,shiftEnterEnabled:true,autoCheckCase:false,alertUpperRatio:[],allowLineBreaksInsideQuotes:true,autoResize:false,autoResizeMargin:20,shortcuts:{bold:"b",italic:"i",underline:"u"},titleMode:false,caretOffset:{left:3,right:3},filterOnPaste:false};e.Editor=e.lang.Dispatcher.extend({constructor:function(i,f){this.textareaElement=typeof(i)==="string"?document.getElementById(i):i;this.config=e.lang.object({}).merge(c).merge(f).get();this.textarea=new e.views.Textarea(this,this.textareaElement,this.config);this.currentView=this.textarea;this._isCompatible=e.browser.supported();if(!this._isCompatible||(!this.config.supportTouchDevices&&e.browser.isTouchDevice())){var g=this;setTimeout(function(){g.fire("beforeload").fire("load")},0);return}e.dom.addClass(document.body,this.config.bodyClassName);this.composer=new e.views.Composer(this,this.textareaElement,this.config);this.currentView=this.composer;if(typeof(this.config.parser)==="function"){this._initParser()}this.on("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer);if(this.config.toolbar){this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar)}});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(h){}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(f){return this.currentView.getValue(f)},setValue:function(f,g){this.fire("unset_placeholder");if(!f){return this.clear()}this.currentView.setValue(f,g);return this},focus:function(f){this.currentView.focus(f);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(f){var g=this.config.parser(f,this.config.parserRules,this.composer.sandbox.getDocument(),this.config.cleanUp);if(typeof(f)==="object"){e.quirks.redraw(f)}return g},_initParser:function(){this.on("paste:composer",function(){var f=true,g=this;g.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(g.composer.element);var h=g.composer.selection.getSelection().anchorNode;g.parse(g.composer.element);g.focus(h)},f)})}})})(b);return b}));